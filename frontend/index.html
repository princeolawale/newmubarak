<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MUBARAK â€” Ramadan 1446</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Scheherazade+New:wght@400;700&family=Cinzel+Decorative:wght@400;700;900&family=Outfit:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ===================== DESIGN TOKENS ===================== */
:root{
  --gold:#C9A84C;--gold2:#F0D080;--gold3:#8a6015;--gold-a15:rgba(201,168,76,0.15);--gold-a30:rgba(201,168,76,0.3);--gold-a50:rgba(201,168,76,0.5);
  --bg:#03080C;--bg2:#070E16;--bg3:#0C1620;--bg4:#111D28;
  --emerald:#1a6b46;--em-glow:rgba(26,107,70,0.4);
  --cream:#F5ECD7;--muted:rgba(245,236,215,0.45);--muted2:rgba(245,236,215,0.25);
  --red-s:rgba(120,25,25,0.9);--blue-s:rgba(18,45,100,0.9);--green-s:rgba(18,65,38,0.9);
  --radius:16px;--sidebar:72px;
  --transition:0.3s cubic-bezier(0.4,0,0.2,1);
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;min-height:100%;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:var(--gold-a30) transparent;}
body{background:var(--bg);color:var(--cream);font-family:'Outfit',sans-serif;font-weight:300;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-thumb{background:var(--gold-a30);border-radius:2px;}

/* ===================== CANVAS / STARS ===================== */
#stars{position:fixed;inset:0;z-index:0;pointer-events:none;}

/* ===================== PAGE 1 â€” LANDING ===================== */
#p1{position:relative;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1;padding:40px 20px 100px;overflow:hidden;}

/* CRAWL â€” Star Wars */
.crawl-stage{position:fixed;inset:0;display:flex;justify-content:center;align-items:flex-end;perspective:450px;overflow:hidden;pointer-events:none;z-index:0;}
.crawl-track{width:min(680px,82vw);transform-origin:50% 100%;transform:rotateX(24deg);animation:crawl 100s linear infinite;opacity:0.13;}
@keyframes crawl{0%{transform:rotateX(24deg) translateY(110vh);}100%{transform:rotateX(24deg) translateY(-1000%);}}
.c-ar{font-family:'Scheherazade New',serif;font-size:clamp(22px,3.8vw,54px);color:var(--gold);text-align:center;line-height:2.1;direction:rtl;padding:8px 0;}
.c-en{font-family:'Amiri',serif;font-size:clamp(10px,1.3vw,17px);color:var(--gold2);text-align:center;font-style:italic;line-height:1.7;padding-bottom:50px;}
.c-div{text-align:center;font-size:26px;color:var(--gold);padding:18px 0;opacity:0.7;}

/* HERO */
.hero-ar{font-family:'Scheherazade New',serif;font-size:clamp(20px,3vw,38px);direction:rtl;color:var(--gold);text-align:center;opacity:0.55;margin-bottom:4px;letter-spacing:0.02em;}
.hero-title{font-family:'Cinzel Decorative',serif;font-size:clamp(28px,7vw,96px);font-weight:900;text-align:center;position:relative;z-index:2;margin-bottom:10px;
  background:linear-gradient(160deg,#6b4a10 0%,#C9A84C 25%,#F5E095 50%,#C9A84C 75%,#6b4a10 100%);
  background-size:300% 300%;animation:heroShimmer 6s ease-in-out infinite,titleGlow 4s ease-in-out infinite;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.06em;}
@keyframes heroShimmer{0%,100%{background-position:0% 50%;}50%{background-position:100% 50%;}}
@keyframes titleGlow{0%,100%{filter:drop-shadow(0 0 20px rgba(201,168,76,0.45));}50%{filter:drop-shadow(0 0 60px rgba(240,208,128,0.9));}}
.hero-sub{font-family:'Amiri',serif;font-size:clamp(12px,1.8vw,20px);color:var(--gold2);text-align:center;opacity:0.7;letter-spacing:0.18em;margin-bottom:56px;}

/* ORNAMENT LINE */
.ornament{display:flex;align-items:center;gap:16px;margin-bottom:36px;width:min(400px,85vw);}
.ornament-line{flex:1;height:1px;background:linear-gradient(90deg,transparent,var(--gold-a50),transparent);}
.ornament-gem{color:var(--gold);font-size:18px;}

/* LOGIN CARD */
.login-card{position:relative;z-index:2;width:min(460px,90vw);margin-bottom:44px;}
.login-card-inner{background:rgba(7,14,22,0.88);border:1px solid var(--gold-a30);border-radius:24px;padding:44px 40px;backdrop-filter:blur(24px);box-shadow:0 0 80px rgba(201,168,76,0.08),0 40px 80px rgba(0,0,0,0.6);}
.login-card-inner::before{content:'';position:absolute;inset:0;border-radius:24px;padding:1px;background:linear-gradient(135deg,rgba(201,168,76,0.6),transparent 50%,rgba(201,168,76,0.3));-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none;}
.moon-float{font-size:48px;text-align:center;display:block;margin-bottom:22px;animation:moonFloat 3.5s ease-in-out infinite;}
@keyframes moonFloat{0%,100%{transform:translateY(0) rotate(-5deg);}50%{transform:translateY(-10px) rotate(5deg);}}
.login-eyebrow{font-size:11px;letter-spacing:0.28em;color:var(--gold);text-transform:uppercase;text-align:center;margin-bottom:6px;}
.login-eyebrow-ar{font-family:'Scheherazade New',serif;font-size:17px;direction:rtl;color:var(--gold2);text-align:center;opacity:0.5;margin-bottom:26px;}
.field{width:100%;background:rgba(255,255,255,0.035);border:1px solid rgba(201,168,76,0.22);border-radius:14px;padding:15px 22px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:16px;font-weight:300;outline:none;transition:all var(--transition);margin-bottom:16px;letter-spacing:0.04em;}
.field::placeholder{color:var(--muted2);}
.field:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,0.1),0 0 30px rgba(201,168,76,0.2);}
.btn-main{width:100%;padding:16px;border:none;border-radius:14px;background:linear-gradient(135deg,#6b4a10,#C9A84C 40%,#F0D080 60%,#C9A84C 80%,#6b4a10);background-size:300% 300%;animation:btnShine 4s ease-in-out infinite;color:#0a0700;font-family:'Cinzel Decorative',serif;font-size:12px;font-weight:700;letter-spacing:0.2em;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;text-transform:uppercase;}
@keyframes btnShine{0%,100%{background-position:0% 50%;}50%{background-position:100% 50%;}}
.btn-main:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(201,168,76,0.45);}

/* COMING SOON ROW */
.cs-row{position:relative;z-index:2;display:flex;gap:18px;flex-wrap:wrap;justify-content:center;width:min(960px,90vw);}
.cs-card{flex:1;min-width:260px;max-width:450px;background:rgba(7,14,22,0.75);border:1px solid rgba(201,168,76,0.18);border-radius:20px;padding:28px 28px 24px;backdrop-filter:blur(16px);}
.cs-card-title{font-family:'Cinzel Decorative',serif;font-size:10px;letter-spacing:0.28em;color:var(--gold);margin-bottom:8px;}
.cs-pill{display:inline-block;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.28);border-radius:20px;padding:3px 12px;font-size:10px;color:var(--gold2);letter-spacing:0.12em;margin-bottom:14px;}
.cs-card p{font-size:13px;color:var(--muted);line-height:1.75;margin-bottom:18px;}
.copy-row{display:flex;gap:8px;align-items:center;}
.copy-val{flex:1;background:rgba(0,0,0,0.35);border:1px solid rgba(201,168,76,0.15);border-radius:10px;padding:9px 14px;font-size:11px;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-copy{padding:9px 16px;background:var(--gold-a15);border:1px solid var(--gold-a30);border-radius:10px;color:var(--gold);font-size:11px;cursor:pointer;transition:all 0.2s;font-family:'Outfit',sans-serif;white-space:nowrap;}
.btn-copy:hover{background:var(--gold-a30);}
.btn-copy.ok{background:rgba(46,204,113,0.15);border-color:#2ecc71;color:#2ecc71;}
.btn-x{display:inline-flex;align-items:center;gap:8px;margin-top:10px;padding:9px 18px;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.12);border-radius:10px;color:#ddd;font-size:12px;text-decoration:none;transition:all 0.2s;font-family:'Outfit',sans-serif;}
.btn-x:hover{background:rgba(255,255,255,0.08);color:#fff;}

/* ===================== MODAL ===================== */
.overlay{position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,0.92);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.5s;}
.overlay.show{opacity:1;pointer-events:all;}
.modal-wrap{text-align:center;position:relative;}
.modal-wrap.pop{animation:popIn 0.65s cubic-bezier(0.175,0.885,0.32,1.275) forwards;}
@keyframes popIn{0%{transform:scale(0.4) translateY(60px);opacity:0;}100%{transform:scale(1) translateY(0);opacity:1;}}
.m-crescent{font-size:90px;display:block;animation:crescentIn 1.2s ease-out forwards;transform:rotate(-200deg) scale(0);}
@keyframes crescentIn{to{transform:rotate(0deg) scale(1);}}
.m-ar{font-family:'Scheherazade New',serif;font-size:clamp(32px,6vw,72px);direction:rtl;color:var(--gold);margin:16px 0 8px;text-shadow:0 0 40px rgba(201,168,76,0.8);}
.m-en{font-family:'Cinzel Decorative',serif;font-size:clamp(22px,4.5vw,58px);font-weight:900;background:linear-gradient(135deg,#C9A84C,#fff5cc,#C9A84C);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:glowBeat 1.8s ease-in-out infinite;}
@keyframes glowBeat{0%,100%{filter:drop-shadow(0 0 15px rgba(201,168,76,0.5));}50%{filter:drop-shadow(0 0 60px rgba(255,220,80,1));}}
.m-sub{color:var(--gold2);font-size:15px;margin:18px 0 34px;opacity:0.75;letter-spacing:0.05em;}
.m-sub span{color:var(--cream);font-weight:600;}
.btn-scholars{padding:18px 54px;border:none;border-radius:50px;background:linear-gradient(135deg,var(--emerald),#27ae60);color:#fff;font-family:'Cinzel Decorative',serif;font-size:12px;font-weight:700;letter-spacing:0.18em;cursor:pointer;transition:all 0.3s;box-shadow:0 0 40px var(--em-glow);}
.btn-scholars:hover{transform:translateY(-4px);box-shadow:0 10px 50px rgba(26,107,70,0.9);}
.particle{position:absolute;border-radius:50%;animation:pfly 2.8s ease-out forwards;pointer-events:none;}
@keyframes pfly{0%{opacity:1;transform:translate(0,0) scale(1);}100%{opacity:0;transform:var(--tx) scale(0);}}

/* ===================== PAGE 2 ===================== */
#p2{display:none;min-height:100vh;}

/* SIDEBAR */
.sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sidebar);background:rgba(3,8,12,0.97);border-right:1px solid rgba(201,168,76,0.12);z-index:500;display:flex;flex-direction:column;align-items:center;padding:20px 0;gap:4px;backdrop-filter:blur(20px);}
.sb-logo{font-size:24px;margin-bottom:16px;animation:moonFloat 3.5s ease-in-out infinite;}
.sb-sep{width:32px;height:1px;background:var(--gold-a30);margin:8px 0;}
.sb-btn{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;transition:all var(--transition);border:1px solid transparent;color:var(--muted);position:relative;}
.sb-btn:hover,.sb-btn.active{background:var(--gold-a15);border-color:var(--gold-a30);color:var(--gold);}
.sb-btn .tooltip{position:absolute;left:calc(100% + 10px);top:50%;transform:translateY(-50%);background:rgba(7,14,22,0.98);border:1px solid var(--gold-a30);border-radius:10px;padding:6px 14px;font-size:12px;white-space:nowrap;color:var(--gold2);pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:600;}
.sb-btn:hover .tooltip{opacity:1;}
.sb-user{margin-top:auto;font-size:10px;color:var(--muted2);text-align:center;letter-spacing:0.08em;padding:0 4px;}
.sb-avatar{width:36px;height:36px;border-radius:50%;background:var(--gold-a15);border:1px solid var(--gold-a30);display:flex;align-items:center;justify-content:center;font-size:16px;margin-bottom:6px;}

/* MAIN AREA */
.main{margin-left:var(--sidebar);min-height:100vh;position:relative;z-index:1;}
.top-bar{background:rgba(3,8,12,0.95);border-bottom:1px solid rgba(201,168,76,0.1);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:400;backdrop-filter:blur(20px);}
.top-title{font-family:'Cinzel Decorative',serif;font-size:clamp(11px,1.5vw,16px);background:linear-gradient(135deg,var(--gold),var(--gold2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.08em;}
.top-right{display:flex;align-items:center;gap:12px;}
.xp-wrap{display:flex;align-items:center;gap:8px;}
.xp-bar{width:80px;height:4px;background:rgba(255,255,255,0.07);border-radius:2px;overflow:hidden;}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--emerald),#2ecc71);border-radius:2px;transition:width 0.7s ease;width:0%;}
.xp-label{font-size:10px;color:var(--muted);letter-spacing:0.08em;}
.lvl-badge{font-size:10px;color:var(--gold);background:var(--gold-a15);border:1px solid var(--gold-a30);border-radius:8px;padding:3px 10px;letter-spacing:0.06em;}
.user-chip{background:var(--gold-a15);border:1px solid var(--gold-a30);border-radius:20px;padding:6px 16px;font-size:12px;color:var(--gold2);display:flex;align-items:center;gap:6px;}

/* SECTION PAGES */
.section{display:none;padding:40px 28px;max-width:1100px;}
.section.active{display:block;}
.sec-title{font-family:'Cinzel Decorative',serif;font-size:clamp(18px,3vw,30px);color:var(--gold);margin-bottom:6px;letter-spacing:0.08em;}
.sec-title-ar{font-family:'Scheherazade New',serif;font-size:clamp(20px,2.5vw,30px);direction:rtl;color:var(--gold2);opacity:0.55;margin-bottom:28px;}

/* ===================== SCHOLARS ===================== */
.scholars-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;margin-bottom:40px;}
.sc-card{border-radius:22px;padding:28px 24px;cursor:pointer;transition:all 0.35s;border:1.5px solid transparent;position:relative;overflow:hidden;}
.sc-card:hover{transform:translateY(-8px);}
.sc-card.active-card{border-color:var(--gold);box-shadow:0 0 50px rgba(201,168,76,0.2);}
.sc-card.q{background:linear-gradient(160deg,rgba(120,25,25,0.3),rgba(7,14,22,0.95));}
.sc-card.s{background:linear-gradient(160deg,rgba(18,45,100,0.3),rgba(7,14,22,0.95));}
.sc-card.m{background:linear-gradient(160deg,rgba(18,65,38,0.3),rgba(7,14,22,0.95));}
.sc-card:hover.q{box-shadow:0 24px 70px rgba(120,25,25,0.45);}
.sc-card:hover.s{box-shadow:0 24px 70px rgba(18,45,100,0.5);}
.sc-card:hover.m{box-shadow:0 24px 70px rgba(18,65,38,0.45);}
.sc-card::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 25% 25%,rgba(201,168,76,0.1),transparent 55%);pointer-events:none;}
.sc-emoji{font-size:50px;text-align:center;display:block;margin-bottom:14px;}
.sc-name{font-family:'Cinzel Decorative',serif;font-size:14px;color:var(--gold);text-align:center;margin-bottom:3px;}
.sc-ar{font-family:'Scheherazade New',serif;font-size:18px;direction:rtl;color:var(--gold2);text-align:center;opacity:0.6;margin-bottom:10px;}
.sc-badge{display:block;text-align:center;font-size:10px;letter-spacing:0.12em;border-radius:20px;padding:3px 12px;margin-bottom:12px;}
.q .sc-badge{background:rgba(120,25,25,0.3);color:#e08080;border:1px solid rgba(120,25,25,0.5);}
.s .sc-badge{background:rgba(18,45,100,0.3);color:#80a8e0;border:1px solid rgba(18,45,100,0.5);}
.m .sc-badge{background:rgba(18,65,38,0.3);color:#80c898;border:1px solid rgba(18,65,38,0.5);}
.sc-desc{font-size:12px;color:var(--muted);text-align:center;line-height:1.7;}

/* CHAT */
.chat-wrap{max-width:760px;}
.chat-head{border-radius:18px 18px 0 0;padding:18px 22px;display:flex;align-items:center;gap:14px;border:1px solid rgba(201,168,76,0.2);border-bottom:none;}
.chat-head.q{background:linear-gradient(135deg,rgba(120,25,25,0.5),rgba(7,14,22,0.98));}
.chat-head.s{background:linear-gradient(135deg,rgba(18,45,100,0.5),rgba(7,14,22,0.98));}
.chat-head.m{background:linear-gradient(135deg,rgba(18,65,38,0.5),rgba(7,14,22,0.98));}
.chat-head-av{font-size:32px;}
.chat-head-info .chat-head-name{font-family:'Cinzel Decorative',serif;font-size:13px;color:var(--gold);}
.chat-head-info .chat-head-ar{font-family:'Scheherazade New',serif;font-size:17px;direction:rtl;color:var(--gold2);opacity:0.55;}
.online-dot{width:7px;height:7px;border-radius:50%;background:#2ecc71;animation:blink 2s infinite;margin-left:auto;}
.online-txt{font-size:10px;color:#2ecc71;letter-spacing:0.12em;margin-left:6px;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.2;}}
.chat-msgs{background:rgba(7,14,22,0.95);border:1px solid rgba(201,168,76,0.12);height:400px;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:14px;}
.msg{display:flex;gap:10px;align-items:flex-start;animation:msgIn 0.3s ease-out;}
@keyframes msgIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.msg.user{flex-direction:row-reverse;}
.msg-av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;border:1px solid var(--gold-a30);}
.msg-bbl{max-width:72%;padding:11px 15px;border-radius:16px;font-size:13.5px;line-height:1.75;}
.msg.ai .msg-bbl{background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.15);color:var(--cream);border-radius:4px 16px 16px 16px;}
.msg.user .msg-bbl{background:linear-gradient(135deg,rgba(201,168,76,0.15),rgba(201,168,76,0.07));border:1px solid var(--gold-a30);color:var(--cream);border-radius:16px 4px 16px 16px;}
.thinking{display:flex;gap:5px;align-items:center;}
.dot{width:6px;height:6px;border-radius:50%;background:var(--gold);opacity:0.3;animation:dotPulse 1.4s infinite;}
.dot:nth-child(2){animation-delay:0.2s;}.dot:nth-child(3){animation-delay:0.4s;}
@keyframes dotPulse{0%,80%,100%{opacity:0.3;}40%{opacity:1;}}
.chat-input-wrap{background:rgba(5,10,16,0.97);border:1px solid rgba(201,168,76,0.15);border-top:none;border-radius:0 0 18px 18px;padding:14px;display:flex;gap:10px;align-items:flex-end;}
.chat-in{flex:1;background:rgba(255,255,255,0.04);border:1px solid rgba(201,168,76,0.18);border-radius:12px;padding:11px 16px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:14px;font-weight:300;outline:none;transition:border-color 0.2s,box-shadow 0.2s;resize:none;max-height:110px;}
.chat-in:focus{border-color:var(--gold);box-shadow:0 0 0 2px rgba(201,168,76,0.08);}
.btn-send{padding:11px 20px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--gold3),var(--gold));color:#0a0700;font-size:17px;font-weight:700;cursor:pointer;transition:all 0.2s;flex-shrink:0;}
.btn-send:hover{transform:scale(1.07);}
.btn-send:disabled{opacity:0.3;cursor:not-allowed;transform:none;}
.quick-row{display:flex;gap:8px;flex-wrap:wrap;padding:14px 0 0;}
.q-btn{padding:6px 14px;background:var(--gold-a15);border:1px solid var(--gold-a30);border-radius:20px;color:var(--muted);font-size:11px;cursor:pointer;transition:all 0.2s;font-family:'Outfit',sans-serif;}
.q-btn:hover{background:rgba(201,168,76,0.22);color:var(--gold2);}
.back-btn{background:none;border:1px solid rgba(201,168,76,0.18);border-radius:10px;padding:8px 18px;color:var(--muted);cursor:pointer;font-size:12px;transition:all 0.2s;font-family:'Outfit',sans-serif;display:inline-block;margin:14px 0 30px;}
.back-btn:hover{color:var(--gold);border-color:var(--gold-a50);}

/* ===================== SCHOLAR BATTLE ===================== */
.battle-input-area{background:rgba(7,14,22,0.9);border:1px solid var(--gold-a30);border-radius:18px;padding:28px;margin-bottom:28px;}
.battle-input-area h3{font-family:'Cinzel Decorative',serif;font-size:13px;color:var(--gold);margin-bottom:6px;letter-spacing:0.1em;}
.battle-input-area p{font-size:13px;color:var(--muted);margin-bottom:18px;}
.battle-in{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--gold-a30);border-radius:14px;padding:14px 18px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:15px;outline:none;transition:all 0.2s;margin-bottom:14px;}
.battle-in:focus{border-color:var(--gold);}
.btn-battle{padding:14px 40px;border:none;border-radius:14px;background:linear-gradient(135deg,#7a1a1a,#b83232,#7a1a1a);background-size:200%;animation:battleShine 3s infinite;color:#fff;font-family:'Cinzel Decorative',serif;font-size:12px;font-weight:700;letter-spacing:0.2em;cursor:pointer;transition:all 0.3s;}
@keyframes battleShine{0%,100%{background-position:0%;}50%{background-position:100%;}}
.btn-battle:hover{transform:translateY(-2px);box-shadow:0 10px 40px rgba(180,50,50,0.5);}
.battle-cols{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
@media(max-width:700px){.battle-cols{grid-template-columns:1fr;}}
.b-col{border-radius:18px;padding:22px 18px;border:1px solid rgba(201,168,76,0.15);min-height:300px;display:flex;flex-direction:column;}
.b-col.q{background:linear-gradient(180deg,rgba(120,25,25,0.25),rgba(7,14,22,0.9));}
.b-col.s{background:linear-gradient(180deg,rgba(18,45,100,0.25),rgba(7,14,22,0.9));}
.b-col.m{background:linear-gradient(180deg,rgba(18,65,38,0.25),rgba(7,14,22,0.9));}
.b-col-head{display:flex;align-items:center;gap:10px;margin-bottom:16px;padding-bottom:14px;border-bottom:1px solid rgba(201,168,76,0.12);}
.b-col-avatar{font-size:26px;}
.b-col-name{font-family:'Cinzel Decorative',serif;font-size:11px;color:var(--gold);letter-spacing:0.05em;}
.b-col-ar{font-family:'Scheherazade New',serif;font-size:14px;color:var(--gold2);opacity:0.6;}
.b-answer{font-size:13px;color:var(--cream);line-height:1.75;flex:1;}
.b-vote{margin-top:16px;padding-top:14px;border-top:1px solid rgba(201,168,76,0.1);}
.btn-vote{width:100%;padding:9px;border:1px solid var(--gold-a30);border-radius:10px;background:var(--gold-a15);color:var(--gold);font-size:12px;cursor:pointer;transition:all 0.2s;font-family:'Outfit',sans-serif;letter-spacing:0.05em;}
.btn-vote:hover{background:var(--gold-a30);}
.btn-vote.voted{background:linear-gradient(135deg,var(--gold3),var(--gold));color:#0a0700;font-weight:600;border-color:var(--gold);}

/* ===================== DUA GENERATOR ===================== */
.dua-wrap{max-width:700px;}
.dua-form{background:rgba(7,14,22,0.9);border:1px solid var(--gold-a30);border-radius:20px;padding:32px;margin-bottom:28px;}
.dua-form label{display:block;font-size:11px;letter-spacing:0.2em;color:var(--gold);text-transform:uppercase;margin-bottom:10px;}
.dua-textarea{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--gold-a30);border-radius:14px;padding:16px 18px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:14px;font-weight:300;outline:none;resize:none;height:120px;transition:border-color 0.2s;line-height:1.7;margin-bottom:16px;}
.dua-textarea:focus{border-color:var(--gold);}
.dua-moods{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;}
.mood-tag{padding:6px 16px;border:1px solid var(--gold-a30);border-radius:20px;color:var(--muted);font-size:12px;cursor:pointer;transition:all 0.2s;background:rgba(0,0,0,0.2);}
.mood-tag:hover,.mood-tag.sel{background:var(--gold-a15);color:var(--gold2);border-color:var(--gold-a50);}
.btn-dua{padding:14px 44px;border:none;border-radius:14px;background:linear-gradient(135deg,#0f3d25,var(--emerald),#0f3d25);background-size:200%;animation:duaShine 3s infinite;color:#d4f5e0;font-family:'Cinzel Decorative',serif;font-size:11px;font-weight:700;letter-spacing:0.2em;cursor:pointer;transition:all 0.3s;}
@keyframes duaShine{0%,100%{background-position:0%;}50%{background-position:100%;}}
.btn-dua:hover{transform:translateY(-2px);box-shadow:0 10px 40px var(--em-glow);}
.dua-result{background:rgba(7,14,22,0.95);border:1px solid var(--gold-a30);border-radius:20px;padding:32px;display:none;}
.dua-result.show{display:block;animation:fadeUp 0.5s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.dua-ar{font-family:'Scheherazade New',serif;font-size:clamp(22px,3.5vw,38px);direction:rtl;color:var(--gold2);text-align:center;line-height:2.2;margin-bottom:18px;border-bottom:1px solid var(--gold-a30);padding-bottom:18px;}
.dua-latin{font-family:'Amiri',serif;font-size:clamp(14px,1.8vw,18px);color:var(--gold);text-align:center;font-style:italic;margin-bottom:14px;}
.dua-meaning{font-size:14px;color:var(--muted);text-align:center;line-height:1.8;}

/* ===================== RAMADAN TIMER ===================== */
.timer-wrap{display:flex;flex-direction:column;align-items:center;gap:32px;padding:20px 0;}
.moon-clock{position:relative;width:260px;height:260px;margin:0 auto;}
.moon-ring{position:absolute;inset:0;border-radius:50%;border:2px solid var(--gold-a30);}
.moon-ring2{position:absolute;inset:12px;border-radius:50%;border:1px solid rgba(201,168,76,0.12);}
.moon-svg{position:absolute;inset:0;animation:moonRotate 30s linear infinite;}
@keyframes moonRotate{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
.moon-center{position:absolute;inset:30px;border-radius:50%;background:radial-gradient(circle,rgba(201,168,76,0.08),transparent);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
.timer-type{font-size:10px;letter-spacing:0.25em;color:var(--gold);text-transform:uppercase;margin-bottom:4px;}
.timer-countdown{font-family:'Cinzel Decorative',serif;font-size:clamp(22px,4vw,38px);color:var(--gold2);letter-spacing:0.05em;}
.timer-label{font-size:11px;color:var(--muted);margin-top:4px;}
.timer-cards{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;width:100%;max-width:700px;}
.t-card{flex:1;min-width:180px;background:rgba(7,14,22,0.9);border:1px solid var(--gold-a30);border-radius:18px;padding:22px 18px;text-align:center;}
.t-card-icon{font-size:32px;margin-bottom:8px;display:block;}
.t-card-label{font-size:10px;letter-spacing:0.2em;color:var(--gold);text-transform:uppercase;margin-bottom:6px;}
.t-card-time{font-family:'Cinzel Decorative',serif;font-size:22px;color:var(--gold2);}
.t-card-sub{font-size:11px;color:var(--muted);margin-top:4px;}
.location-btn{padding:10px 24px;background:var(--gold-a15);border:1px solid var(--gold-a30);border-radius:12px;color:var(--gold);font-size:13px;cursor:pointer;transition:all 0.2s;font-family:'Outfit',sans-serif;}
.location-btn:hover{background:var(--gold-a30);}

/* ===================== QUESTION OF THE DAY ===================== */
.qod-wrap{max-width:760px;}
.qod-card{background:linear-gradient(135deg,rgba(18,45,100,0.25),rgba(7,14,22,0.95));border:1px solid var(--gold-a30);border-radius:22px;padding:32px;margin-bottom:28px;}
.qod-scholar{display:flex;align-items:center;gap:14px;margin-bottom:20px;}
.qod-scholar-av{font-size:42px;}
.qod-q{font-family:'Scheherazade New',serif;font-size:clamp(18px,3vw,28px);direction:rtl;color:var(--gold);line-height:1.8;margin-bottom:8px;}
.qod-q-en{font-family:'Amiri',serif;font-size:clamp(15px,2vw,20px);color:var(--cream);font-style:italic;line-height:1.7;}
.answer-box{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--gold-a30);border-radius:14px;padding:14px 18px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:14px;resize:none;height:110px;outline:none;transition:border-color 0.2s;margin-bottom:14px;}
.answer-box:focus{border-color:var(--gold);}
.btn-submit{padding:12px 36px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--gold3),var(--gold));color:#0a0700;font-family:'Cinzel Decorative',serif;font-size:11px;font-weight:700;letter-spacing:0.15em;cursor:pointer;transition:all 0.3s;}
.btn-submit:hover{transform:translateY(-2px);box-shadow:0 8px 30px var(--gold-a30);}
.community-title{font-family:'Cinzel Decorative',serif;font-size:12px;color:var(--gold);letter-spacing:0.15em;margin-bottom:16px;}
.comm-answers{display:flex;flex-direction:column;gap:12px;}
.comm-item{background:rgba(7,14,22,0.85);border:1px solid rgba(201,168,76,0.12);border-radius:14px;padding:16px 18px;display:flex;gap:12px;align-items:flex-start;}
.comm-av{width:32px;height:32px;border-radius:50%;background:var(--gold-a15);border:1px solid var(--gold-a30);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.comm-body{}
.comm-name{font-size:11px;color:var(--gold);letter-spacing:0.05em;margin-bottom:4px;}
.comm-text{font-size:13px;color:var(--muted);line-height:1.65;}
.comm-likes{font-size:11px;color:rgba(201,168,76,0.5);margin-top:6px;}

/* ===================== AYAH OF THE MOMENT ===================== */
.ayah-wrap{max-width:700px;text-align:center;}
.ayah-card{background:rgba(7,14,22,0.95);border:1px solid var(--gold-a30);border-radius:24px;padding:44px 36px;margin-bottom:28px;min-height:300px;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.ayah-bismillah{font-family:'Scheherazade New',serif;font-size:24px;direction:rtl;color:var(--gold);opacity:0.5;margin-bottom:24px;}
.ayah-ar{font-family:'Scheherazade New',serif;font-size:clamp(24px,4vw,44px);direction:rtl;color:var(--gold2);line-height:2.1;margin-bottom:20px;text-align:center;}
.ayah-ref{font-size:11px;color:var(--gold);letter-spacing:0.2em;margin-bottom:14px;opacity:0.7;}
.ayah-en{font-family:'Amiri',serif;font-size:clamp(14px,2vw,19px);color:var(--muted);font-style:italic;line-height:1.75;text-align:center;}
.ayah-reflection{margin-top:20px;padding-top:20px;border-top:1px solid var(--gold-a30);font-size:13px;color:var(--muted);line-height:1.75;font-style:italic;text-align:left;}
.btn-ayah{padding:16px 50px;border:none;border-radius:50px;background:linear-gradient(135deg,#0f3d25,var(--emerald));color:#d4f5e0;font-family:'Cinzel Decorative',serif;font-size:12px;letter-spacing:0.2em;cursor:pointer;transition:all 0.3s;box-shadow:0 0 30px var(--em-glow);}
.btn-ayah:hover{transform:translateY(-3px);box-shadow:0 10px 50px rgba(26,107,70,0.8);}

/* ===================== JOURNAL ===================== */
.journal-wrap{max-width:800px;}
.journal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;}
.streak-badge{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,rgba(255,120,0,0.15),rgba(255,60,0,0.1));border:1px solid rgba(255,120,0,0.3);border-radius:20px;padding:8px 20px;font-size:13px;color:#ffaa55;}
.streak-num{font-family:'Cinzel Decorative',serif;font-size:22px;color:#ff8822;}
.calendar-strip{display:flex;gap:6px;overflow-x:auto;padding-bottom:8px;margin-bottom:28px;}
.cal-day{min-width:44px;height:52px;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px solid rgba(201,168,76,0.15);font-size:11px;color:var(--muted);cursor:pointer;transition:all 0.2s;background:rgba(7,14,22,0.7);}
.cal-day.has-entry{border-color:var(--gold-a50);background:var(--gold-a15);color:var(--gold);}
.cal-day.today{border-color:var(--gold);box-shadow:0 0 20px var(--gold-a30);}
.cal-day .day-num{font-family:'Cinzel Decorative',serif;font-size:14px;margin-bottom:2px;}
.journal-editor{background:rgba(7,14,22,0.9);border:1px solid var(--gold-a30);border-radius:20px;padding:28px;margin-bottom:20px;}
.journal-date{font-size:11px;letter-spacing:0.2em;color:var(--gold);text-transform:uppercase;margin-bottom:16px;}
.journal-ta{width:100%;background:rgba(255,255,255,0.03);border:1px solid rgba(201,168,76,0.15);border-radius:14px;padding:18px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:14px;font-weight:300;outline:none;resize:none;height:180px;transition:border-color 0.2s;line-height:1.8;}
.journal-ta:focus{border-color:var(--gold);}
.journal-btns{display:flex;gap:12px;margin-top:14px;}
.btn-journal-save{padding:12px 32px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--gold3),var(--gold));color:#0a0700;font-family:'Cinzel Decorative',serif;font-size:11px;font-weight:700;letter-spacing:0.15em;cursor:pointer;transition:all 0.3s;}
.btn-journal-save:hover{transform:translateY(-2px);box-shadow:0 8px 30px var(--gold-a30);}
.btn-reflect{padding:12px 28px;border:1px solid var(--gold-a30);border-radius:12px;background:none;color:var(--muted);font-size:12px;cursor:pointer;transition:all 0.2s;font-family:'Outfit',sans-serif;}
.btn-reflect:hover{color:var(--gold);border-color:var(--gold-a50);}
.reflection-box{background:linear-gradient(135deg,rgba(18,45,100,0.2),rgba(7,14,22,0.9));border:1px solid rgba(18,45,100,0.4);border-radius:16px;padding:22px;margin-top:16px;display:none;}
.reflection-box.show{display:block;animation:fadeUp 0.5s ease;}
.reflection-box p{font-family:'Amiri',serif;font-size:15px;color:var(--gold2);font-style:italic;line-height:1.9;}

/* ===================== 99 NAMES ===================== */
.names-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px;margin-bottom:30px;}
.name-card{background:rgba(7,14,22,0.85);border:1px solid rgba(201,168,76,0.12);border-radius:16px;padding:18px 12px;text-align:center;cursor:pointer;transition:all 0.25s;}
.name-card:hover{border-color:var(--gold-a50);background:var(--gold-a15);transform:translateY(-4px);}
.name-num{font-size:10px;color:var(--muted2);margin-bottom:6px;letter-spacing:0.1em;}
.name-ar{font-family:'Scheherazade New',serif;font-size:22px;direction:rtl;color:var(--gold);margin-bottom:4px;}
.name-en{font-size:10px;color:var(--muted);letter-spacing:0.05em;}
.name-modal{position:fixed;inset:0;z-index:8000;background:rgba(0,0,0,0.88);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s;}
.name-modal.show{opacity:1;pointer-events:all;}
.name-modal-box{background:rgba(7,14,22,0.98);border:1px solid var(--gold-a50);border-radius:26px;padding:40px;max-width:560px;width:90%;text-align:center;animation:popIn 0.4s ease;}
.name-modal-ar{font-family:'Scheherazade New',serif;font-size:clamp(40px,7vw,80px);direction:rtl;color:var(--gold);margin-bottom:8px;}
.name-modal-latin{font-size:13px;letter-spacing:0.2em;color:var(--gold2);margin-bottom:20px;text-transform:uppercase;}
.name-modal-meaning{font-size:14px;color:var(--muted);line-height:1.8;margin-bottom:20px;}
.name-modal-ai{font-family:'Amiri',serif;font-size:15px;color:var(--cream);font-style:italic;line-height:1.9;border-top:1px solid var(--gold-a30);padding-top:18px;display:none;}
.name-modal-ai.show{display:block;animation:fadeUp 0.5s ease;}
.btn-close-nm{margin-top:20px;padding:10px 30px;border:1px solid var(--gold-a30);border-radius:12px;background:none;color:var(--muted);cursor:pointer;transition:all 0.2s;font-family:'Outfit',sans-serif;}
.btn-close-nm:hover{color:var(--gold);}

/* ===================== ISNAD ===================== */
.isnad-wrap{max-width:800px;}
.isnad-form{background:rgba(7,14,22,0.9);border:1px solid var(--gold-a30);border-radius:20px;padding:28px;margin-bottom:28px;}
.isnad-ta{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--gold-a30);border-radius:14px;padding:14px 18px;color:var(--cream);font-family:'Outfit',sans-serif;font-size:14px;resize:none;height:110px;outline:none;transition:border-color 0.2s;margin-bottom:14px;}
.isnad-ta:focus{border-color:var(--gold);}
.btn-isnad{padding:13px 40px;border:none;border-radius:14px;background:linear-gradient(135deg,#3a1a5e,#6a2fa0,#3a1a5e);background-size:200%;animation:isnadShine 3s infinite;color:#e0d0ff;font-family:'Cinzel Decorative',serif;font-size:11px;letter-spacing:0.2em;cursor:pointer;transition:all 0.3s;}
@keyframes isnadShine{0%,100%{background-position:0%;}50%{background-position:100%;}}
.btn-isnad:hover{transform:translateY(-2px);box-shadow:0 10px 40px rgba(100,50,180,0.5);}
.isnad-viz{display:none;background:rgba(7,14,22,0.95);border:1px solid rgba(100,50,180,0.3);border-radius:20px;padding:28px;}
.isnad-viz.show{display:block;animation:fadeUp 0.5s ease;}
.chain-title{font-family:'Cinzel Decorative',serif;font-size:14px;color:var(--gold);text-align:center;margin-bottom:24px;}
.chain-flow{display:flex;flex-direction:column;align-items:center;gap:0;}
.chain-node{background:linear-gradient(135deg,rgba(100,50,180,0.2),rgba(7,14,22,0.9));border:1px solid rgba(100,50,180,0.4);border-radius:16px;padding:16px 24px;width:min(480px,100%);text-align:center;position:relative;}
.chain-node-ar{font-family:'Scheherazade New',serif;font-size:20px;direction:rtl;color:#c0a0ff;margin-bottom:3px;}
.chain-node-en{font-size:12px;color:var(--muted);letter-spacing:0.05em;}
.chain-node-era{font-size:10px;color:rgba(180,150,255,0.5);margin-top:3px;letter-spacing:0.08em;}
.chain-arrow{font-size:22px;color:rgba(100,50,180,0.6);padding:4px 0;}

/* ===================== TOAST / XP ===================== */
.toast{position:fixed;top:76px;right:20px;z-index:9999;background:linear-gradient(135deg,rgba(26,107,70,0.97),rgba(7,14,22,0.97));border:1px solid rgba(46,204,113,0.45);border-radius:14px;padding:12px 22px;color:#2ecc71;font-size:13px;pointer-events:none;animation:toastIn 0.3s ease,toastOut 0.3s 2.6s ease forwards;}
@keyframes toastIn{from{opacity:0;transform:translateX(110%);}to{opacity:1;transform:translateX(0);}}
@keyframes toastOut{to{opacity:0;}}
</style>
</head>
<body>
<canvas id="stars"></canvas>

<!-- ============================== PAGE 1 ============================== -->
<div id="p1">
  <div class="crawl-stage"><div class="crawl-track">
    <div class="c-div">â˜½</div>
    <div class="c-ar">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
    <div class="c-en">In the name of Allah, the Most Gracious, the Most Merciful</div>
    <div class="c-div">âœ¦</div>
    <div class="c-ar">Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø£ÙÙ†Ø²ÙÙ„Ù ÙÙÙŠÙ‡Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ù‡ÙØ¯Ù‹Ù‰ Ù„ÙÙ‘Ù„Ù†ÙÙ‘Ø§Ø³Ù</div>
    <div class="c-en">The month of Ramadan in which was revealed the Quran â€” Al-Baqarah 2:185</div>
    <div class="c-div">â˜½</div>
    <div class="c-ar">ÙˆÙØ¥ÙØ°ÙØ§ Ø³ÙØ£ÙÙ„ÙÙƒÙ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠ Ø¹ÙÙ†ÙÙ‘ÙŠ ÙÙØ¥ÙÙ†ÙÙ‘ÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ Ø£ÙØ¬ÙÙŠØ¨Ù Ø¯ÙØ¹Ù’ÙˆÙØ©Ù Ø§Ù„Ø¯ÙÙ‘Ø§Ø¹Ù</div>
    <div class="c-en">When My servants ask about Me, I am indeed near â€” Al-Baqarah 2:186</div>
    <div class="c-div">âœ¦</div>
    <div class="c-ar">Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù†ÙÙˆØ±Ù Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙØ§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù</div>
    <div class="c-en">Allah is the Light of the heavens and the earth â€” An-Nur 24:35</div>
    <div class="c-div">â˜½</div>
    <div class="c-ar">Ø¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§</div>
    <div class="c-en">Verily, with every difficulty comes ease â€” Al-Inshirah 94:6</div>
    <div class="c-div">âœ¦</div>
    <div class="c-ar">Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¹Ù Ø§Ù„ØµÙÙ‘Ø§Ø¨ÙØ±ÙÙŠÙ†Ù</div>
    <div class="c-en">Verily, Allah is with the patient ones â€” Al-Baqarah 2:153</div>
    <div class="c-div">â˜½</div>
    <div class="c-ar">Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹</div>
    <div class="c-en">Our Lord, give us good in this world and good in the Hereafter</div>
    <div class="c-div">âœ¦</div>
  </div></div>

  <div class="hero-ar">Ù…ÙØ¨ÙØ§Ø±ÙÙƒ</div>
  <h1 class="hero-title">MUBARAK</h1>
  <p class="hero-sub">âœ¦ &nbsp; RAMADAN 1446 &nbsp;Â·&nbsp; AI CIRCLE OF SCHOLARS &nbsp; âœ¦</p>

  <div class="ornament">
    <div class="ornament-line"></div>
    <div class="ornament-gem">âœ¦</div>
    <div class="ornament-line"></div>
  </div>

  <div class="login-card">
    <div class="login-card-inner">
      <span class="moon-float">ğŸŒ™</span>
      <p class="login-eyebrow">Enter to Begin Â· Ø£Ø¯Ø®Ù„ Ù„Ù„Ø¨Ø¯Ø¡</p>
      <p class="login-eyebrow-ar">Ø­ÙÙ„Ù’Ù‚ÙØ©Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙ…ÙØ§Ø¡ ØªÙÙ†Ù’ØªÙØ¸ÙØ±ÙÙƒÙ</p>
      <input class="field" id="name-in" type="text" placeholder="Your name / Ø§Ø³Ù…Ùƒ" maxlength="30" autocomplete="off">
      <button class="btn-main" onclick="onEnter()">ENTER THE CIRCLE &nbsp;Â·&nbsp; Ø§Ø¯Ø®Ù„</button>
    </div>
  </div>

  <div class="cs-row">
    <div class="cs-card">
      <div class="cs-card-title">ğŸ“± Mobile App</div>
      <span class="cs-pill">â³ COMING SOON</span>
      <p>Full Mubarak on iOS & Android â€” prayer times, scholars in your pocket, daily Ramadan tracker.</p>
      <div class="copy-row">
        <div class="copy-val">mubarak.app</div>
        <button class="btn-copy" id="cc1" onclick="doCopy('mubarak.app','cc1')">Copy</button>
      </div>
    </div>
    <div class="cs-card">
      <div class="cs-card-title">ğ• Follow on X</div>
      <span class="cs-pill">ğŸ“£ DAILY UPDATES</span>
      <p>Daily Quran verses, Ramadan insights, AI scholar highlights â€” join the global ummah online.</p>
      <div class="copy-row">
        <div class="copy-val">@mubarak</div>
        <button class="btn-copy" id="cc2" onclick="doCopy('@mubarak','cc2')">Copy</button>
      </div>
      <a href="https://x.com" target="_blank" class="btn-x">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.748l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        Open on X
      </a>
    </div>
  </div>
</div>

<!-- ============================== MODAL ============================== -->
<div class="overlay" id="modal">
  <div class="modal-wrap" id="modal-wrap">
    <span class="m-crescent">â˜½</span>
    <div class="m-ar">Ø±ÙÙ…ÙØ¶ÙØ§Ù† Ù…ÙØ¨ÙØ§Ø±ÙÙƒ</div>
    <div class="m-en">RAMADAN MUBARAK</div>
    <p class="m-sub">Welcome, <span id="m-name"></span> â€” the scholars await you</p>
    <button class="btn-scholars" onclick="toP2()">Enter the Circle of Scholars âœ¦</button>
  </div>
</div>

<!-- 99 NAMES MODAL -->
<div class="name-modal" id="name-modal">
  <div class="name-modal-box">
    <div class="name-modal-ar" id="nm-ar"></div>
    <div class="name-modal-latin" id="nm-latin"></div>
    <div class="name-modal-meaning" id="nm-meaning"></div>
    <div class="name-modal-ai" id="nm-ai"></div>
    <button class="btn-close-nm" onclick="closeNameModal()">Close âœ¦</button>
  </div>
</div>

<!-- ============================== PAGE 2 ============================== -->
<div id="p2">
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sb-logo">ğŸŒ™</div>
    <div class="sb-sep"></div>
    <div class="sb-btn active" onclick="showSec('scholars')" id="sb-scholars">ğŸ“–<span class="tooltip">Circle of Scholars</span></div>
    <div class="sb-btn" onclick="showSec('battle')" id="sb-battle">âš”ï¸<span class="tooltip">Scholar Battle</span></div>
    <div class="sb-btn" onclick="showSec('dua')" id="sb-dua">ğŸ¤²<span class="tooltip">Dua Generator</span></div>
    <div class="sb-btn" onclick="showSec('timer')" id="sb-timer">â±ï¸<span class="tooltip">Ramadan Timer</span></div>
    <div class="sb-btn" onclick="showSec('qod')" id="sb-qod">ğŸ“…<span class="tooltip">Question of the Day</span></div>
    <div class="sb-btn" onclick="showSec('ayah')" id="sb-ayah">âœ¨<span class="tooltip">Ayah of the Moment</span></div>
    <div class="sb-btn" onclick="showSec('journal')" id="sb-journal">ğŸ““<span class="tooltip">Ramadan Journal</span></div>
    <div class="sb-btn" onclick="showSec('names')" id="sb-names">â˜ªï¸<span class="tooltip">99 Names of Allah</span></div>
    <div class="sb-btn" onclick="showSec('isnad')" id="sb-isnad">ğŸ”—<span class="tooltip">Isnad Visualizer</span></div>
    <div class="sb-sep"></div>
    <div class="sb-avatar">ğŸ‘¤</div>
    <div class="sb-user" id="sb-uname">User</div>
  </nav>

  <!-- MAIN -->
  <div class="main">
    <div class="top-bar">
      <div class="top-title">ğŸŒ™ &nbsp; MUBARAK &nbsp;Â·&nbsp; RAMADAN 1446</div>
      <div class="top-right">
        <div class="xp-wrap">
          <span class="xp-label">XP</span>
          <div class="xp-bar"><div class="xp-fill" id="xp-fill"></div></div>
          <span class="lvl-badge" id="lvl-badge">Novice</span>
        </div>
        <div class="user-chip">ğŸŒ™ <span id="top-uname">User</span></div>
      </div>
    </div>

    <!-- ===== SCHOLARS ===== -->
    <div class="section active" id="sec-scholars">
      <div class="sec-title">âœ¦ Circle of Scholars</div>
      <div class="sec-title-ar">Ø­ÙÙ„Ù’Ù‚ÙØ©Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙ…ÙØ§Ø¡</div>
      <div class="scholars-grid" id="sc-grid">
        <div class="sc-card q" onclick="pickScholar('q')"><span class="sc-emoji">ğŸ“–</span><div class="sc-name">Imam Al-Faruq</div><div class="sc-ar">Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„ÙØ§Ø±ÙˆÙ‚</div><span class="sc-badge">GUARDIAN OF THE QURAN</span><div class="sc-desc">Grounds every answer in specific Quranic verses and authentic hadith. Measures, cites, illuminates with tafsir depth.</div></div>
        <div class="sc-card s" onclick="pickScholar('s')"><span class="sc-emoji">ğŸ“¿</span><div class="sc-name">Sheikh Yusuf</div><div class="sc-ar">Ø§Ù„Ø´ÙŠØ® ÙŠÙˆØ³Ù</div><span class="sc-badge">SUFI MYSTIC</span><div class="sc-desc">Speaks through poetry and parables. Draws from Rumi, Al-Ghazali, Ibn Arabi â€” the language of the heart.</div></div>
        <div class="sc-card m" onclick="pickScholar('m')"><span class="sc-emoji">ğŸŒ</span><div class="sc-name">Ustaz Adam</div><div class="sc-ar">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¢Ø¯Ù…</div><span class="sc-badge">MODERN MUSLIM GUIDE</span><div class="sc-desc">Young, relatable, direct. Islam in 2025 â€” halal lifestyle, mental health, real deen for real life.</div></div>
      </div>
      <div id="chat-area" style="display:none;">
        <div class="chat-wrap">
          <div id="ch-head" class="chat-head q">
            <span class="chat-head-av" id="ch-av">ğŸ“–</span>
            <div class="chat-head-info">
              <div class="chat-head-name" id="ch-name">Imam Al-Faruq</div>
              <div class="chat-head-ar" id="ch-ar">Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„ÙØ§Ø±ÙˆÙ‚</div>
            </div>
            <div class="online-dot"></div><span class="online-txt">ONLINE</span>
          </div>
          <div class="chat-msgs" id="chat-msgs"></div>
          <div class="chat-input-wrap">
            <textarea class="chat-in" id="chat-in" placeholder="Ask your question... / Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ùƒ..." rows="1" onkeydown="chatKey(event)" oninput="grow(this)"></textarea>
            <button class="btn-send" id="send-btn" onclick="sendChat()">â¤</button>
          </div>
        </div>
        <div class="quick-row" id="quick-row"></div>
        <button class="back-btn" onclick="backSc()">â† Choose Another Scholar</button>
      </div>
    </div>

    <!-- ===== BATTLE ===== -->
    <div class="section" id="sec-battle">
      <div class="sec-title">âš”ï¸ Scholar Battle Mode</div>
      <div class="sec-title-ar">Ù…ÙØ¹ÙØ§Ø±ÙÙƒÙØ©Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙ…ÙØ§Ø¡</div>
      <div class="battle-input-area">
        <h3>ASK ALL THREE SCHOLARS</h3>
        <p>One question. Three simultaneous answers. Vote for the best â€” earn XP.</p>
        <input class="battle-in" id="battle-q" type="text" placeholder="Ask anything... e.g. What is the meaning of Ramadan?">
        <button class="btn-battle" onclick="startBattle()">âš”ï¸ &nbsp; START THE BATTLE</button>
      </div>
      <div class="battle-cols" id="battle-cols">
        <div class="b-col q"><div class="b-col-head"><span class="b-col-avatar">ğŸ“–</span><div><div class="b-col-name">Imam Al-Faruq</div><div class="b-col-ar">Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„ÙØ§Ø±ÙˆÙ‚</div></div></div><div class="b-answer" id="ba-q"><span style="color:var(--muted2);font-size:13px;">Awaiting the battle...</span></div><div class="b-vote"><button class="btn-vote" id="bv-q" onclick="vote('q')">ğŸ‘‘ Vote for Imam</button></div></div>
        <div class="b-col s"><div class="b-col-head"><span class="b-col-avatar">ğŸ“¿</span><div><div class="b-col-name">Sheikh Yusuf</div><div class="b-col-ar">Ø§Ù„Ø´ÙŠØ® ÙŠÙˆØ³Ù</div></div></div><div class="b-answer" id="ba-s"><span style="color:var(--muted2);font-size:13px;">Awaiting the battle...</span></div><div class="b-vote"><button class="btn-vote" id="bv-s" onclick="vote('s')">âœ¨ Vote for Sheikh</button></div></div>
        <div class="b-col m"><div class="b-col-head"><span class="b-col-avatar">ğŸŒ</span><div><div class="b-col-name">Ustaz Adam</div><div class="b-col-ar">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¢Ø¯Ù…</div></div></div><div class="b-answer" id="ba-m"><span style="color:var(--muted2);font-size:13px;">Awaiting the battle...</span></div><div class="b-vote"><button class="btn-vote" id="bv-m" onclick="vote('m')">ğŸŒ Vote for Ustaz</button></div></div>
      </div>
    </div>

    <!-- ===== DUA ===== -->
    <div class="section" id="sec-dua">
      <div class="sec-title">ğŸ¤² Dua Generator</div>
      <div class="sec-title-ar">Ù…ÙÙˆÙÙ„ÙÙ‘Ø¯Ù Ø§Ù„Ø¯ÙÙ‘Ø¹ÙØ§Ø¡</div>
      <div class="dua-wrap">
        <div class="dua-form">
          <label>Describe your state of heart</label>
          <div class="dua-moods">
            <span class="mood-tag" onclick="pickMood(this)">ğŸ˜” Sad</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸ˜° Anxious</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸ’” Heartbroken</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸ˜¤ Overwhelmed</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸ™ Grateful</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸŒŸ Seeking guidance</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸ’ª Seeking strength</span>
            <span class="mood-tag" onclick="pickMood(this)">ğŸ˜” Lost a loved one</span>
          </div>
          <textarea class="dua-textarea" id="dua-state" placeholder="Tell Imam Al-Faruq how you feel, what you need... He will compose a personal dua for you."></textarea>
          <button class="btn-dua" onclick="genDua()">ğŸ¤² &nbsp; Generate My Dua</button>
        </div>
        <div class="dua-result" id="dua-result">
          <div class="dua-ar" id="dua-ar"></div>
          <div class="dua-latin" id="dua-latin"></div>
          <div class="dua-meaning" id="dua-meaning"></div>
        </div>
      </div>
    </div>

    <!-- ===== TIMER ===== -->
    <div class="section" id="sec-timer">
      <div class="sec-title">â±ï¸ Ramadan Prayer Timer</div>
      <div class="sec-title-ar">Ù…ÙÙˆÙØ§Ù‚ÙÙŠØªÙ Ø§Ù„ØµÙÙ‘Ù„Ø§ÙØ©</div>
      <div class="timer-wrap">
        <div class="moon-clock">
          <div class="moon-ring"></div><div class="moon-ring2"></div>
          <svg class="moon-svg" viewBox="0 0 260 260">
            <circle cx="130" cy="130" r="120" fill="none" stroke="rgba(201,168,76,0.15)" stroke-width="1" stroke-dasharray="4 8"/>
            <circle cx="130" cy="10" r="5" fill="#C9A84C" opacity="0.8"/>
          </svg>
          <div class="moon-center">
            <div class="timer-type" id="timer-type">IFTAAR</div>
            <div class="timer-countdown" id="timer-cd">--:--:--</div>
            <div class="timer-label" id="timer-lbl">Loading...</div>
          </div>
        </div>
        <button class="location-btn" onclick="getLocation()">ğŸ“ Use My Location</button>
        <div class="timer-cards" id="timer-cards">
          <div class="t-card"><span class="t-card-icon">ğŸŒ…</span><div class="t-card-label">Fajr / Suhoor</div><div class="t-card-time" id="t-fajr">--:--</div><div class="t-card-sub">Dawn prayer</div></div>
          <div class="t-card"><span class="t-card-icon">â˜€ï¸</span><div class="t-card-label">Sunrise</div><div class="t-card-time" id="t-sunrise">--:--</div><div class="t-card-sub">End of Suhoor</div></div>
          <div class="t-card"><span class="t-card-icon">ğŸ•Œ</span><div class="t-card-label">Dhuhr</div><div class="t-card-time" id="t-dhuhr">--:--</div><div class="t-card-sub">Midday prayer</div></div>
          <div class="t-card"><span class="t-card-icon">ğŸŒ†</span><div class="t-card-label">Iftaar / Maghrib</div><div class="t-card-time" id="t-maghrib">--:--</div><div class="t-card-sub">Break the fast</div></div>
        </div>
      </div>
    </div>

    <!-- ===== QOD ===== -->
    <div class="section" id="sec-qod">
      <div class="sec-title">ğŸ“… Question of the Day</div>
      <div class="sec-title-ar">Ø³ÙØ¤ÙØ§Ù„Ù Ø§Ù„Ù’ÙŠÙÙˆÙ…</div>
      <div class="qod-wrap">
        <div class="qod-card">
          <div class="qod-scholar">
            <span class="qod-scholar-av" id="qod-av">ğŸ“¿</span>
            <div>
              <div style="font-family:'Cinzel Decorative',serif;font-size:12px;color:var(--gold);letter-spacing:0.08em;" id="qod-sname">Sheikh Yusuf asks:</div>
              <div style="font-size:11px;color:var(--muted);">Today's reflection question</div>
            </div>
          </div>
          <div class="qod-q" id="qod-ar">Ù„ÙÙ…ÙØ§Ø°ÙØ§ ØªÙØµÙÙˆÙ…Ù ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ø±ÙÙ‘Ù…ÙØ¶ÙØ§Ù†ØŸ</div>
          <div class="qod-q-en" id="qod-en">"Why do you fast this Ramadan? What transformation are you seeking?"</div>
        </div>
        <textarea class="answer-box" id="qod-answer" placeholder="Share your reflection..."></textarea>
        <button class="btn-submit" onclick="submitQOD()">Submit Reflection âœ¦</button>
        <div style="height:30px;"></div>
        <div class="community-title">âœ¦ COMMUNITY REFLECTIONS</div>
        <div class="comm-answers" id="comm-answers">
          <div class="comm-item"><div class="comm-av">ğŸŒ™</div><div class="comm-body"><div class="comm-name">IBRAHIM Â· Istanbul</div><div class="comm-text">I fast to remember those who go without by choice or fate. Ramadan humbles me and reconnects me to gratitude and empathy.</div><div class="comm-likes">â¤ï¸ 47 hearts</div></div></div>
          <div class="comm-item"><div class="comm-av">â­</div><div class="comm-body"><div class="comm-name">FATIMAH Â· Cairo</div><div class="comm-text">This year I fast for inner peace. The hunger reminds me that my soul hungers too â€” for knowledge, for closeness to Allah.</div><div class="comm-likes">â¤ï¸ 38 hearts</div></div></div>
          <div class="comm-item"><div class="comm-av">ğŸ•Œ</div><div class="comm-body"><div class="comm-name">YUSUF Â· London</div><div class="comm-text">I fast because in the silence of hunger, I hear my own heart more clearly. Subhan Allah.</div><div class="comm-likes">â¤ï¸ 29 hearts</div></div></div>
        </div>
      </div>
    </div>

    <!-- ===== AYAH ===== -->
    <div class="section" id="sec-ayah">
      <div class="sec-title">âœ¨ Ayah of the Moment</div>
      <div class="sec-title-ar">Ø¢ÙŠÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ø­Ø¸ÙØ©</div>
      <div class="ayah-wrap">
        <div class="ayah-card" id="ayah-card">
          <div class="ayah-bismillah">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù</div>
          <div class="ayah-ar" id="ayah-ar">Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù„ØªÙ„Ù‚ÙŠ Ø¢ÙŠØªÙƒ</div>
          <div class="ayah-ref" id="ayah-ref">Press the button below</div>
          <div class="ayah-en" id="ayah-en">Imam Al-Faruq will select a verse from the Quran chosen specifically for this moment in your journey.</div>
          <div class="ayah-reflection" id="ayah-reflect" style="display:none;"></div>
        </div>
        <button class="btn-ayah" onclick="getAyah()">âœ¨ &nbsp; Reveal My Ayah</button>
      </div>
    </div>

    <!-- ===== JOURNAL ===== -->
    <div class="section" id="sec-journal">
      <div class="sec-title">ğŸ““ Ramadan Journal</div>
      <div class="sec-title-ar">ÙŠÙÙˆÙ’Ù…ÙÙŠÙÙ‘Ø§ØªÙ Ø§Ù„Ø±ÙÙ‘Ù…ÙØ¶ÙØ§Ù†</div>
      <div class="journal-wrap">
        <div class="journal-header">
          <div style="font-size:13px;color:var(--muted);">Your private fast journal</div>
          <div class="streak-badge">ğŸ”¥ <span class="streak-num" id="streak-num">0</span>&nbsp;day streak</div>
        </div>
        <div class="calendar-strip" id="cal-strip"></div>
        <div class="journal-editor">
          <div class="journal-date" id="j-date"></div>
          <textarea class="journal-ta" id="j-ta" placeholder="How was your fast today? What did you feel? What dua touched your heart? What will you carry forward..."></textarea>
          <div class="journal-btns">
            <button class="btn-journal-save" onclick="saveJournal()">Save Entry âœ¦</button>
            <button class="btn-reflect" onclick="aiReflect()">âœ¨ Get Sheikh Yusuf's Reflection</button>
          </div>
          <div class="reflection-box" id="reflect-box">
            <p id="reflect-text"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== 99 NAMES ===== -->
    <div class="section" id="sec-names">
      <div class="sec-title">â˜ªï¸ 99 Names of Allah</div>
      <div class="sec-title-ar">Ø£ÙØ³Ù’Ù…ÙØ§Ø¡Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø­ÙØ³Ù’Ù†ÙÙ‰</div>
      <div class="names-grid" id="names-grid"></div>
    </div>

    <!-- ===== ISNAD ===== -->
    <div class="section" id="sec-isnad">
      <div class="sec-title">ğŸ”— Isnad Chain Visualizer</div>
      <div class="sec-title-ar">Ù…ÙØµÙÙˆÙÙ‘Ø±Ù Ø³ÙÙ„Ù’Ø³ÙÙ„ÙØ©Ù Ø§Ù„Ø¥ÙØ³Ù’Ù†ÙØ§Ø¯</div>
      <div class="isnad-wrap">
        <div class="isnad-form">
          <p style="font-size:13px;color:var(--muted);margin-bottom:16px;line-height:1.7;">Paste any hadith below â€” Imam Al-Faruq will construct the chain of narrators (isnad) as a visual flow from Prophet Muhammad ï·º to you.</p>
          <textarea class="isnad-ta" id="isnad-in" placeholder="e.g. The Prophet ï·º said: 'Actions are judged by intentions...' (Bukhari)"></textarea>
          <button class="btn-isnad" onclick="genIsnad()">ğŸ”— &nbsp; Visualize Isnad Chain</button>
        </div>
        <div class="isnad-viz" id="isnad-viz">
          <div class="chain-title">âœ¦ Chain of Narration âœ¦</div>
          <div class="chain-flow" id="chain-flow"></div>
        </div>
      </div>
    </div>

  </div><!-- /main -->
</div><!-- /p2 -->

<script>
// ==================== CONFIG ====================
// API config â€” backend will inject real key
const API = "https://newmubarak.onrender.com/chat"; 
const MODEL = 'deepseek-chat';

// ==================== STARS ====================
const SC = document.getElementById('stars'), SCX = SC.getContext('2d');
let ST = [];
function rsz(){SC.width=innerWidth;SC.height=innerHeight;}
function mkStars(){ST=[];for(let i=0;i<180;i++)ST.push({x:Math.random()*SC.width,y:Math.random()*SC.height,r:Math.random()*1.3+0.2,o:Math.random(),s:(Math.random()*0.005+0.002)*(Math.random()>.5?1:-1)});}
function drStars(){SCX.clearRect(0,0,SC.width,SC.height);ST.forEach(s=>{s.o+=s.s;if(s.o>1||s.o<0)s.s*=-1;SCX.beginPath();SCX.arc(s.x,s.y,s.r,0,Math.PI*2);SCX.fillStyle=`rgba(201,168,76,${Math.max(0,Math.min(1,s.o*.75))})`;SCX.fill();});requestAnimationFrame(drStars);}
rsz();mkStars();drStars();addEventListener('resize',()=>{rsz();mkStars();});

// ==================== STATE ====================
let username='', XP=0, chatH=[], curScholar=null, battleDone=false;
const LEVELS=[{n:'Novice',m:0},{n:'Seeker',m:100},{n:'Student',m:300},{n:'Scholar',m:700},{n:'Alim',m:1200},{n:'Sheikh',m:2000}];
const SCHOLARS={
  q:{name:'Imam Al-Faruq',ar:'Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„ÙØ§Ø±ÙˆÙ‚',av:'ğŸ“–',cls:'q',
    sys:`You are Imam Al-Faruq, an Islamic scholar specializing in Quranic tafsir and hadith sciences. Be measured, precise, warm. ALWAYS cite specific Quranic verses (surah name + ayah number). Include Arabic text when quoting Quran. You speak during Ramadan 1446. Start first message with Islamic greeting.`,
    quick:['What does Quran say about Ramadan?','Explain Surah Al-Fatiha','What is Laylat al-Qadr?','Best duas for Ramadan?','What is tafsir?']},
  s:{name:'Sheikh Yusuf',ar:'Ø§Ù„Ø´ÙŠØ® ÙŠÙˆØ³Ù',av:'ğŸ“¿',cls:'s',
    sys:`You are Sheikh Yusuf, a Sufi mystic. Speak through metaphor, poetry, and Rumi-inspired wisdom. Every answer should contain a poetic element. Explore Islam as a path of the heart. You speak during Ramadan 1446.`,
    quick:['Spiritual meaning of fasting?','What is dhikr?','How to purify the heart?','What is tasawwuf?','Love of Allah â€” what does it mean?']},
  m:{name:'Ustaz Adam',ar:'Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¢Ø¯Ù…',av:'ğŸŒ',cls:'m',
    sys:`You are Ustaz Adam, a young modern Muslim scholar. Speak casually, relatable, like a knowledgeable friend. Address modern life: halal food, work, mental health, relationships â€” through an Islamic lens. You're excited about Ramadan 2025.`,
    quick:['Staying productive while fasting?','Is music haram?','Halal dating â€” real talk?','Dealing with Ramadan pressure?','Work-life balance in Ramadan?']}
};

// ==================== PAGE 1 ====================
document.getElementById('name-in').addEventListener('keydown',e=>{if(e.key==='Enter')onEnter();});
function onEnter(){
  const v=document.getElementById('name-in').value.trim();
  if(!v)return;
  username=v;
  document.getElementById('m-name').textContent=v;
  // particles
  const wrap=document.getElementById('modal-wrap');
  for(let i=0;i<35;i++){
    const el=document.createElement('div');el.className='particle';
    const a=Math.random()*Math.PI*2,d=100+Math.random()*220;
    el.style.cssText=`left:50%;top:40%;width:${3+Math.random()*5}px;height:${3+Math.random()*5}px;background:${Math.random()>.5?'#C9A84C':'#F0D080'};animation-delay:${Math.random()*.5}s;`;
    el.style.setProperty('--tx',`translate(${Math.cos(a)*d}px,${Math.sin(a)*d}px)`);
    wrap.appendChild(el);setTimeout(()=>el.remove(),3500);
  }
  document.getElementById('modal').classList.add('show');
}
function toP2(){
  document.getElementById('modal').classList.remove('show');
  document.getElementById('p1').style.display='none';
  document.getElementById('p2').style.display='block';
  document.getElementById('top-uname').textContent=username;
  document.getElementById('sb-uname').textContent=username;
  initJournal();initQOD();initTimer();
}

// ==================== NAVIGATION ====================
function showSec(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.sb-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('sec-'+id).classList.add('active');
  document.getElementById('sb-'+id).classList.add('active');
  if(id==='names')buildNames();
}

// ==================== AI HELPER ====================
async function callAI(system, messages, maxTokens=900){
  // FRONTEND STUB â€” backend will replace this with real API call
  await new Promise(r=>setTimeout(r,1200));
  const last = messages[messages.length-1]?.content||'';
  const isQuran = system.includes('Imam');
  const isSufi = system.includes('Sheikh Yusuf');
  const isModern = system.includes('Ustaz Adam');
  const isDua = system.includes('personal dua');
  const isAyah = system.includes('Quranic verse');
  const isReflect = system.includes('journal');
  const isName = system.includes('divine Name');
  const isIsnad = system.includes('isnad');
  const isBattle = system.includes('3-4 sentences');

  if(isDua) return JSON.stringify({
    arabic:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø§Ù„Ù’Ù‡ÙØ¯ÙÙ‰ ÙˆÙØ§Ù„ØªÙÙ‘Ù‚ÙÙ‰ ÙˆÙØ§Ù„Ù’Ø¹ÙÙÙØ§ÙÙ ÙˆÙØ§Ù„Ù’ØºÙÙ†ÙÙ‰",
    transliteration:"Allahumma inni as'aluka al-huda wat-tuqa wal-'afafa wal-ghina",
    meaning:"O Allah, I ask You for guidance, piety, chastity and self-sufficiency. This dua asks Allah for everything the heart truly needs â€” direction, righteousness, and peace."
  });

  if(isAyah) return JSON.stringify({
    arabic:"ÙˆÙØ¥ÙØ°ÙØ§ Ø³ÙØ£ÙÙ„ÙÙƒÙ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠ Ø¹ÙÙ†ÙÙ‘ÙŠ ÙÙØ¥ÙÙ†ÙÙ‘ÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ",
    transliteration:"Wa idha sa'alaka 'ibadi 'anni fa-inni qarib",
    english:"And when My servants ask you about Me â€” I am indeed near.",
    reference:"Al-Baqarah, Ayah 2:186",
    reflection:"This verse is a direct promise from Allah â€” He does not say 'tell them I am near', He says 'I am near' Himself. In Ramadan, the veil between du'a and answer grows thin. Speak to Him as if He is listening. Because He is."
  });

  if(isIsnad) return JSON.stringify({
    title:"Actions are judged by intentions",
    chain:[
      {arabic:"Ø§Ù„Ù†ÙÙ‘Ø¨ÙÙŠÙÙ‘ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ ï·º",english:"Prophet Muhammad ï·º",era:"Prophet of Allah, d. 632 CE"},
      {arabic:"Ø¹ÙÙ…ÙØ±Ù Ø¨Ù’Ù†Ù Ø§Ù„Ù’Ø®ÙØ·ÙÙ‘Ø§Ø¨",english:"Umar ibn al-Khattab",era:"Companion, d. 644 CE"},
      {arabic:"Ø¹ÙÙ„Ù’Ù‚ÙÙ…ÙØ©Ù Ø¨Ù’Ù†Ù ÙˆÙÙ‚ÙÙ‘Ø§Øµ",english:"Alqama ibn Waqqas",era:"Successor, d. 690 CE"},
      {arabic:"Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù Ø¨Ù’Ù†Ù Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…",english:"Muhammad ibn Ibrahim",era:"Scholar, d. 723 CE"},
      {arabic:"ÙŠÙØ­Ù’ÙŠÙÙ‰ Ø¨Ù’Ù†Ù Ø³ÙØ¹ÙÙŠØ¯",english:"Yahya ibn Sa'id",era:"Hadith master, d. 760 CE"},
      {arabic:"Ø§Ù„Ø¥ÙÙ…ÙØ§Ù…Ù Ø§Ù„Ù’Ø¨ÙØ®ÙØ§Ø±ÙÙŠ",english:"Imam Al-Bukhari",era:"Compiled in Sahih al-Bukhari, d. 870 CE"}
    ]
  });

  if(isName) return "This blessed Name appears in the opening of every surah, reminding the believer that Allah's mercy precedes His might. To reflect on this Name daily â€” especially in Ramadan â€” is to unlock a door of rahma that never closes. Let it be on your tongue at the start of every action, every meal broken at Iftaar, every prayer offered in the night.";

  if(isReflect) return "*The one who fasts carries a lantern inside them that others cannot see, but those nearby feel its warmth.* Your words today are seeds planted in the soil of this holy month â€” Sheikh Yusuf sees sincerity in every line. Even in struggle, you showed up. That itself is ibadah.";

  if(isBattle||isSufi) return "*Rumi once wrote: 'Silence is the ocean, speech is the river' â€” and yet in Ramadan even silence speaks.* The fast strips away the noise of the world until only the sound of your own heart remains. That heartbeat is your dhikr, your zikr, your continuous remembrance of the One who gave it to you.";

  if(isModern) return `Honestly bro, that's such a real question and I respect you for asking it. Here's the thing â€” Islam doesn't ask you to be perfect, it asks you to be *present*. The Prophet ï·º said the most beloved deeds to Allah are the most consistent ones, even if they're small. Start with one thing this Ramadan. Just one. Build from there. Allah sees effort, not just results.`;

  return `Bismillahir Rahmanir Rahim. As-salamu alaykum dear seeker ğŸŒ™

JazakAllah khayran for your question. The Quran reminds us in Surah Al-Baqarah (2:186): *"And when My servants ask you about Me â€” I am indeed near."*

This month of Ramadan is a gift â€” 30 days in which the gates of mercy are opened wide. Whatever you seek, bring it to Allah in these blessed nights. He is closer than you imagine.`;
}

// ==================== SCHOLARS CHAT ====================
function pickScholar(k){
  curScholar=k;chatH=[];
  document.querySelectorAll('.sc-card').forEach(c=>c.classList.remove('active-card'));
  document.querySelector('.sc-card.'+k).classList.add('active-card');
  const d=SCHOLARS[k];
  document.getElementById('ch-head').className='chat-head '+k;
  document.getElementById('ch-av').textContent=d.av;
  document.getElementById('ch-name').textContent=d.name;
  document.getElementById('ch-ar').textContent=d.ar;
  document.getElementById('chat-msgs').innerHTML='';
  document.getElementById('chat-area').style.display='block';
  document.getElementById('sc-grid').style.display='none';
  document.getElementById('quick-row').innerHTML=d.quick.map(q=>`<button class="q-btn" onclick="useQ('${encodeURIComponent(q)}')">${q}</button>`).join('');
  const openers={
    q:`As-salamu alaykum wa rahmatullahi wa barakatuh, dear ${username}! ğŸŒ™\n\nBismillahir Rahmanir Rahim. Welcome to this blessed gathering of knowledge. During these sacred days of Ramadan 1446, I am here to share guidance from the Holy Quran and the Sunnah of our Prophet ï·º. What knowledge do you seek today?`,
    s:`Peace be upon your soul, dear ${username}... ğŸ•Œ\n\n*"Out beyond ideas of wrongdoing and rightdoing, there is a field. I'll meet you there."* â€” Rumi\n\nRamadan is not merely the hunger of the stomach. It is the awakening of the heart. In this holy month, every breath is a prayer. What does your soul seek?`,
    m:`Wa alaikum assalam ${username}! ğŸ™Œâœ¨\n\nBro/sis â€” Ramadan Mubarak! Honestly this is THE season. 30 days to level up in every dimension â€” spiritually, mentally, physically. I'm Ustaz Adam, your modern Muslim guide. No boring fatwa lectures, just real deen for real life. What's on your mind?`
  };
  addMsg('ai',openers[k]);
  document.getElementById('chat-area').scrollIntoView({behavior:'smooth'});
}
function backSc(){
  document.getElementById('chat-area').style.display='none';
  document.getElementById('sc-grid').style.display='grid';
  document.querySelectorAll('.sc-card').forEach(c=>c.classList.remove('active-card'));
  curScholar=null;chatH=[];
}
function addMsg(role,text){
  const c=document.getElementById('chat-msgs');
  const d=curScholar?SCHOLARS[curScholar]:SCHOLARS.q;
  const div=document.createElement('div');div.className='msg '+role;
  const txt=text.replace(/\n/g,'<br>').replace(/\*(.*?)\*/g,'<em>$1</em>');
  div.innerHTML=`<div class="msg-av">${role==='ai'?d.av:'ğŸ‘¤'}</div><div class="msg-bbl">${txt}</div>`;
  c.appendChild(div);c.scrollTop=c.scrollHeight;
  if(role==='user')chatH.push({role:'user',content:text});
  else chatH.push({role:'assistant',content:text});
}
function addThink(id='think-main'){const c=document.getElementById('chat-msgs');const d=SCHOLARS[curScholar];const div=document.createElement('div');div.className='msg ai';div.id=id;div.innerHTML=`<div class="msg-av">${d.av}</div><div class="msg-bbl"><div class="thinking"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;c.appendChild(div);c.scrollTop=c.scrollHeight;}
function rmThink(id='think-main'){const el=document.getElementById(id);if(el)el.remove();}
async function sendChat(){
  if(!curScholar)return;
  const inp=document.getElementById('chat-in');const txt=inp.value.trim();if(!txt)return;
  inp.value='';inp.style.height='auto';
  const btn=document.getElementById('send-btn');btn.disabled=true;
  addMsg('user',txt);addThink();
  try{
    const reply=await callAI(SCHOLARS[curScholar].sys,chatH.slice(-10));
    rmThink();addMsg('ai',reply);addXP(25);
  }catch(e){rmThink();addMsg('ai','âš ï¸ Connection error â€” please check API configuration.');}
  btn.disabled=false;
}
function chatKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();}}
function useQ(enc){document.getElementById('chat-in').value=decodeURIComponent(enc);sendChat();}
function grow(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,110)+'px';}

// ==================== BATTLE ====================
async function startBattle(){
  const q=document.getElementById('battle-q').value.trim();if(!q)return;
  const ids=['q','s','m'];
  ids.forEach(k=>{document.getElementById('ba-'+k).innerHTML='<div class="thinking"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';document.getElementById('bv-'+k).disabled=true;document.getElementById('bv-'+k).classList.remove('voted');});
  battleDone=false;
  const promises=ids.map(k=>callAI(SCHOLARS[k].sys+'\n\nKeep your answer to 3-4 sentences â€” concise and powerful.',[{role:'user',content:q}],400));
  try{
    const results=await Promise.all(promises);
    results.forEach((r,i)=>{
      const k=ids[i];
      document.getElementById('ba-'+k).innerHTML=r.replace(/\n/g,'<br>').replace(/\*(.*?)\*/g,'<em>$1</em>');
      document.getElementById('bv-'+k).disabled=false;
    });
    battleDone=true;addXP(30);
  }catch(e){ids.forEach(k=>{document.getElementById('ba-'+k).textContent='âš ï¸ Error loading answer.';});}
}
function vote(winner){
  if(!battleDone)return;
  ['q','s','m'].forEach(k=>{const b=document.getElementById('bv-'+k);b.disabled=true;b.classList.remove('voted');});
  document.getElementById('bv-'+winner).classList.add('voted');
  addXP(15);showToast(`+15 XP â€” You voted for ${SCHOLARS[winner].name}!`);
}

// ==================== DUA ====================
function pickMood(el){document.querySelectorAll('.mood-tag').forEach(t=>t.classList.remove('sel'));el.classList.add('sel');const txt=el.textContent.replace(/^\S+\s/,'');document.getElementById('dua-state').value=txt;}
async function genDua(){
  const state=document.getElementById('dua-state').value.trim();if(!state){alert('Please describe your state of heart');return;}
  const result=document.getElementById('dua-result');result.classList.remove('show');
  document.querySelector('.btn-dua').textContent='ğŸ¤² Composing your dua...';
  const sys=`You are Imam Al-Faruq. Compose a personal, heartfelt dua in Arabic for someone who feels: "${state}". 
Respond ONLY with valid JSON (no markdown):
{"arabic":"<dua in Arabic>","transliteration":"<Latin transliteration>","meaning":"<English meaning and explanation, 2-3 sentences>"}`;
  try{
    const raw=await callAI(sys,[{role:'user',content:`My heart feels: ${state}. Please compose my personal dua.`}],600);
    const clean=raw.replace(/```json|```/g,'').trim();
    const parsed=JSON.parse(clean);
    document.getElementById('dua-ar').textContent=parsed.arabic;
    document.getElementById('dua-latin').textContent=parsed.transliteration;
    document.getElementById('dua-meaning').textContent=parsed.meaning;
    result.classList.add('show');addXP(40);showToast('+40 XP â€” Your personal dua is ready ğŸ¤²');
  }catch(e){alert('Could not generate dua. Please try again.');}
  document.querySelector('.btn-dua').textContent='ğŸ¤²  Generate My Dua';
}

// ==================== TIMER ====================
let timerInterval = null;
let prayerTimes = {};

// Load Mecca by default on page open
window.addEventListener("load", () => {
  fetchPrayers(21.3891, 39.8579, true);
});

// Button click â†’ ask for real location
function getLocation() {
  if (!navigator.geolocation) {
    document.getElementById("timer-lbl").textContent =
      "Geolocation not supported";
    return;
  }

  document.getElementById("timer-lbl").textContent =
    "Requesting your locationâ€¦";

  navigator.geolocation.getCurrentPosition(
    pos => fetchPrayers(pos.coords.latitude, pos.coords.longitude, false),
    () => {
      document.getElementById("timer-lbl").textContent =
        "Location denied â€” showing Mecca time";
    }
  );
}

async function fetchPrayers(lat, lng, isDefault = false) {
  document.getElementById("timer-lbl").textContent = "Loading prayer timesâ€¦";

  try {
    const today = new Date();
    const url = `https://api.aladhan.com/v1/timings/${today.getDate()}-${
      today.getMonth() + 1
    }-${today.getFullYear()}?latitude=${lat}&longitude=${lng}&method=2`;

    const r = await fetch(url);
    const data = await r.json();
    const t = data.data.timings;

    prayerTimes = {
      fajr: t.Fajr,
      sunrise: t.Sunrise,
      dhuhr: t.Dhuhr,
      asr: t.Asr,
      maghrib: t.Maghrib,
      isha: t.Isha
    };

    document.getElementById("t-fajr").textContent = t.Fajr;
    document.getElementById("t-sunrise").textContent = t.Sunrise;
    document.getElementById("t-dhuhr").textContent = t.Dhuhr;
    document.getElementById("t-maghrib").textContent = t.Maghrib;

    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(
      () => updateCountdown(t.Maghrib, t.Fajr),
      1000
    );
    updateCountdown(t.Maghrib, t.Fajr);

    const tz = data.data.meta.timezone;

    document.getElementById("timer-lbl").textContent = isDefault
      ? `Mecca time â€¢ ${tz}`
      : `Your location â€¢ ${tz}`;
  } catch {
    document.getElementById("timer-lbl").textContent =
      "Could not load prayer times";
  }
}

function updateCountdown(maghrib, fajr) {
  const now = new Date();

  function toDate(timeStr) {
    const [h, m] = timeStr.split(":");
    const d = new Date();
    d.setHours(parseInt(h), parseInt(m), 0, 0);
    return d;
  }

  const mag = toDate(maghrib);
  const faj = toDate(fajr);

  let target, type;

  if (now < mag) {
    target = mag;
    type = "IFTAAR";
  } else {
    target = new Date(faj.getTime() + 86400000);
    type = "SUHOOR";
  }

  const diff = target - now;
  if (diff < 0) return;

  const h = Math.floor(diff / 3600000).toString().padStart(2, "0");
  const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, "0");
  const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, "0");

  document.getElementById("timer-cd").textContent = `${h}:${m}:${s}`;
  document.getElementById("timer-type").textContent = type;
}

// ğŸš€ AUTO START TIMER
window.addEventListener("load", initTimer);

// ==================== QOD ====================
const QUESTIONS=[
  {av:'ğŸ“¿',sname:'Sheikh Yusuf',ar:'Ù„ÙÙ…ÙØ§Ø°ÙØ§ ØªÙØµÙÙˆÙ…Ù ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ø±ÙÙ‘Ù…ÙØ¶ÙØ§Ù†ØŸ',en:'"Why do you fast this Ramadan? What transformation are you seeking within yourself?"'},
  {av:'ğŸ“–',sname:'Imam Al-Faruq',ar:'Ù…ÙØ§ Ø£ÙØ¹Ù’Ø¸ÙÙ…Ù Ù…ÙØ§ ØªÙØ¹ÙÙ„ÙÙ‘Ù…Ù’ØªÙÙ‡Ù Ù…ÙÙ†Ù Ø§Ù„Ù‚ÙØ±Ø¢Ù†Ù Ø§Ù„ÙƒÙØ±ÙÙŠÙ…ØŸ',en:'"What is the greatest lesson the Quran has taught you in your life so far?"'},
  {av:'ğŸŒ',sname:'Ustaz Adam',ar:'ÙƒÙÙŠÙ’ÙÙ ØªÙÙˆÙØ§Ø²ÙÙ†Ù Ø¨ÙÙŠÙ’Ù†Ù Ø¯ÙÙŠÙ†ÙÙƒÙ ÙˆÙØ­ÙÙŠÙØ§ØªÙÙƒÙ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…ÙÙŠÙÙ‘Ø©ØŸ',en:'"How do you balance your faith and your daily modern life? What\'s the hardest part?"'},
  {av:'ğŸ“¿',sname:'Sheikh Yusuf',ar:'Ø£ÙÙŠÙÙ‘ Ø§Ø³Ù’Ù…Ù Ù…ÙÙ†Ù’ Ø£ÙØ³Ù’Ù…ÙØ§Ø¡Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø­ÙØ³Ù’Ù†ÙÙ‰ ÙŠÙÙ„ÙØ§Ù…ÙØ³Ù Ù‚ÙÙ„Ù’Ø¨ÙÙƒÙØŸ',en:'"Which of the 99 Names of Allah speaks most deeply to your heart, and why?"'}
];
function initQOD(){
  const idx=new Date().getDate()%QUESTIONS.length;const q=QUESTIONS[idx];
  document.getElementById('qod-av').textContent=q.av;
  document.getElementById('qod-sname').textContent=q.sname+' asks:';
  document.getElementById('qod-ar').textContent=q.ar;
  document.getElementById('qod-en').textContent=q.en;
}
function submitQOD(){
  const val=document.getElementById('qod-answer').value.trim();if(!val)return;
  const container=document.getElementById('comm-answers');
  const div=document.createElement('div');div.className='comm-item';
  div.innerHTML=`<div class="comm-av">âœ¨</div><div class="comm-body"><div class="comm-name">${username.toUpperCase()} Â· Just now</div><div class="comm-text">${val}</div><div class="comm-likes">â¤ï¸ 0 hearts</div></div>`;
  container.insertBefore(div,container.firstChild);
  document.getElementById('qod-answer').value='';
  addXP(35);showToast('+35 XP â€” Reflection shared with the community!');
}

// ==================== AYAH ====================
async function getAyah(){
  document.getElementById('ayah-ar').textContent='Ø¬ÙØ§Ø±Ù ØªÙØ­Ù…ÙÙŠÙ„...';
  document.getElementById('ayah-en').textContent='Imam Al-Faruq is selecting your verse...';
  document.getElementById('ayah-ref').textContent='';
  document.getElementById('ayah-reflect').style.display='none';
  const sys=`You are Imam Al-Faruq. Select one powerful Quranic verse relevant to Ramadan and spiritual growth. 
Respond ONLY with valid JSON (no markdown):
{"arabic":"<verse in Arabic>","transliteration":"<transliteration>","english":"<English translation>","reference":"Surah Name, Ayah X:XX","reflection":"<A 2-3 sentence spiritual reflection on why this verse is meaningful right now>"}`;
  try{
    const raw=await callAI(sys,[{role:'user',content:'Select a Quranic verse for this moment in Ramadan.'}],500);
    const clean=raw.replace(/```json|```/g,'').trim();
    const p=JSON.parse(clean);
    document.getElementById('ayah-ar').textContent=p.arabic;
    document.getElementById('ayah-ref').textContent=p.reference;
    document.getElementById('ayah-en').textContent=p.english;
    const ref=document.getElementById('ayah-reflect');
    ref.textContent=p.reflection;ref.style.display='block';
    addXP(20);showToast('+20 XP â€” Your Ayah has been revealed âœ¨');
  }catch(e){document.getElementById('ayah-ar').textContent='âš ï¸ Error â€” please try again';document.getElementById('ayah-en').textContent='';}
}

// ==================== JOURNAL ====================
function initJournal(){
  const today=new Date();
  document.getElementById('j-date').textContent=`ğŸ“… ${today.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}`;
  const strip=document.getElementById('cal-strip');strip.innerHTML='';
  const days=['S','M','T','W','T','F','S'];
  for(let i=29;i>=0;i--){
    const d=new Date(today);d.setDate(d.getDate()-i);
    const key=`journal_${d.toISOString().split('T')[0]}`;
    const has=localStorage.getItem(key);
    const div=document.createElement('div');div.className='cal-day'+(has?' has-entry':'')+(i===0?' today':'');
    div.innerHTML=`<span class="day-num">${d.getDate()}</span><span>${days[d.getDay()]}</span>`;
    if(has)div.onclick=()=>loadEntry(d.toISOString().split('T')[0]);
    strip.appendChild(div);
  }
  const todayKey=`journal_${today.toISOString().split('T')[0]}`;
  const saved=localStorage.getItem(todayKey);
  if(saved)document.getElementById('j-ta').value=saved;
  // streak
  let streak=0;const cur=new Date(today);
  while(true){const k=`journal_${cur.toISOString().split('T')[0]}`;if(!localStorage.getItem(k))break;streak++;cur.setDate(cur.getDate()-1);}
  document.getElementById('streak-num').textContent=streak;
}
function loadEntry(dateStr){document.getElementById('j-ta').value=localStorage.getItem(`journal_${dateStr}`)||'';}
function saveJournal(){
  const val=document.getElementById('j-ta').value.trim();if(!val)return;
  const key=`journal_${new Date().toISOString().split('T')[0]}`;
  localStorage.setItem(key,val);initJournal();addXP(50);showToast('+50 XP â€” Journal entry saved ğŸ““');
}
async function aiReflect(){
  const val=document.getElementById('j-ta').value.trim();if(!val){alert('Write your journal entry first');return;}
  document.querySelector('.btn-reflect').textContent='âœ¨ Composing reflection...';
  const box=document.getElementById('reflect-box');box.classList.remove('show');
  try{
    const sys=`You are Sheikh Yusuf, Sufi mystic and poet. Read this Ramadan journal entry and write a short poetic reflection (4-6 sentences) using metaphor, Rumi-style language. Be comforting, inspiring, and spiritual.`;
    const reply=await callAI(sys,[{role:'user',content:val}],350);
    document.getElementById('reflect-text').textContent=reply;
    box.classList.add('show');addXP(30);showToast('+30 XP â€” Sheikh Yusuf shared his reflection ğŸ“¿');
  }catch(e){alert('Error â€” please try again.');}
  document.querySelector('.btn-reflect').textContent='âœ¨ Get Sheikh Yusuf\'s Reflection';
}

// ==================== 99 NAMES ====================
const NAMES99=[
  ['Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†','Ar-Rahman','The Most Gracious'],['Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…','Ar-Rahim','The Most Merciful'],['Ø§Ù„Ù’Ù…ÙÙ„ÙÙƒ','Al-Malik','The King'],['Ø§Ù„Ù’Ù‚ÙØ¯ÙÙ‘ÙˆØ³','Al-Quddus','The Most Holy'],['Ø§Ù„Ø³ÙÙ‘Ù„Ø§ÙÙ…','As-Salam','The Source of Peace'],['Ø§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†','Al-Mumin','The Guardian of Faith'],['Ø§Ù„Ù’Ù…ÙÙ‡ÙÙŠÙ’Ù…ÙÙ†','Al-Muhaymin','The Protector'],['Ø§Ù„Ù’Ø¹ÙØ²ÙÙŠØ²','Al-Aziz','The Almighty'],['Ø§Ù„Ù’Ø¬ÙØ¨ÙÙ‘Ø§Ø±','Al-Jabbar','The Compeller'],['Ø§Ù„Ù’Ù…ÙØªÙÙƒÙØ¨ÙÙ‘Ø±','Al-Mutakabbir','The Supreme'],['Ø§Ù„Ù’Ø®ÙØ§Ù„ÙÙ‚','Al-Khaliq','The Creator'],['Ø§Ù„Ù’Ø¨ÙØ§Ø±ÙØ¦','Al-Bari','The Originator'],['Ø§Ù„Ù’Ù…ÙØµÙÙˆÙÙ‘Ø±','Al-Musawwir','The Shaper'],['Ø§Ù„Ù’ØºÙÙÙÙ‘Ø§Ø±','Al-Ghaffar','The All-Forgiving'],['Ø§Ù„Ù’Ù‚ÙÙ‡ÙÙ‘Ø§Ø±','Al-Qahhar','The Subduer'],['Ø§Ù„Ù’ÙˆÙÙ‡ÙÙ‘Ø§Ø¨','Al-Wahhab','The Bestower'],['Ø§Ù„Ø±ÙÙ‘Ø²ÙÙ‘Ø§Ù‚','Ar-Razzaq','The Provider'],['Ø§Ù„Ù’ÙÙØªÙÙ‘Ø§Ø­','Al-Fattah','The Opener'],['Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ…','Al-Alim','The All-Knowing'],['Ø§Ù„Ù’Ù‚ÙØ§Ø¨ÙØ¶','Al-Qabid','The Withholder'],['Ø§Ù„Ù’Ø¨ÙØ§Ø³ÙØ·','Al-Basit','The Expander'],['Ø§Ù„Ù’Ø®ÙØ§ÙÙØ¶','Al-Khafid','The Abaser'],['Ø§Ù„Ø±ÙÙ‘Ø§ÙÙØ¹','Ar-Rafi','The Exalter'],['Ø§Ù„Ù’Ù…ÙØ¹ÙØ²','Al-Muizz','The Honourer'],['Ø§Ù„Ù’Ù…ÙØ°ÙÙ„','Al-Mudhill','The Humiliator'],['Ø§Ù„Ø³ÙÙ‘Ù…ÙÙŠØ¹','As-Sami','The All-Hearing'],['Ø§Ù„Ù’Ø¨ÙØµÙÙŠØ±','Al-Basir','The All-Seeing'],['Ø§Ù„Ù’Ø­ÙÙƒÙÙ…','Al-Hakam','The Judge'],['Ø§Ù„Ù’Ø¹ÙØ¯Ù’Ù„','Al-Adl','The Just'],['Ø§Ù„Ù„ÙÙ‘Ø·ÙÙŠÙ','Al-Latif','The Subtle One'],['Ø§Ù„Ù’Ø®ÙØ¨ÙÙŠØ±','Al-Khabir','The All-Aware'],['Ø§Ù„Ù’Ø­ÙÙ„ÙÙŠÙ…','Al-Halim','The Forbearing'],['Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…','Al-Azim','The Magnificent'],['Ø§Ù„Ù’ØºÙÙÙÙˆØ±','Al-Ghafur','The Forgiving'],['Ø§Ù„Ø´ÙÙ‘ÙƒÙÙˆØ±','Ash-Shakur','The Grateful'],['Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ‘','Al-Ali','The Most High'],['Ø§Ù„Ù’ÙƒÙØ¨ÙÙŠØ±','Al-Kabir','The Grand'],['Ø§Ù„Ù’Ø­ÙÙÙÙŠØ¸','Al-Hafiz','The Preserver'],['Ø§Ù„Ù’Ù…ÙÙ‚ÙÙŠØª','Al-Muqit','The Sustainer'],['Ø§Ù„Ù’Ø­ÙØ³ÙÙŠØ¨','Al-Hasib','The Reckoner'],['Ø§Ù„Ù’Ø¬ÙÙ„ÙÙŠÙ„','Al-Jalil','The Majestic'],['Ø§Ù„Ù’ÙƒÙØ±ÙÙŠÙ…','Al-Karim','The Generous'],['Ø§Ù„Ø±ÙÙ‘Ù‚ÙÙŠØ¨','Ar-Raqib','The Watchful'],['Ø§Ù„Ù’Ù…ÙØ¬ÙÙŠØ¨','Al-Mujib','The Responsive'],['Ø§Ù„Ù’ÙˆÙØ§Ø³ÙØ¹','Al-Wasi','The All-Encompassing'],['Ø§Ù„Ù’Ø­ÙÙƒÙÙŠÙ…','Al-Hakim','The Wise'],['Ø§Ù„Ù’ÙˆÙØ¯ÙÙˆØ¯','Al-Wadud','The Loving'],['Ø§Ù„Ù’Ù…ÙØ¬ÙÙŠØ¯','Al-Majid','The Glorious'],['Ø§Ù„Ù’Ø¨ÙØ§Ø¹ÙØ«','Al-Baith','The Resurrector'],['Ø§Ù„Ø´ÙÙ‘Ù‡ÙÙŠØ¯','Ash-Shahid','The Witness'],['Ø§Ù„Ù’Ø­ÙÙ‚','Al-Haqq','The Truth'],['Ø§Ù„Ù’ÙˆÙÙƒÙÙŠÙ„','Al-Wakil','The Trustee'],['Ø§Ù„Ù’Ù‚ÙÙˆÙÙŠÙ‘','Al-Qawwiy','The Powerful'],['Ø§Ù„Ù’Ù…ÙØªÙÙŠÙ†','Al-Matin','The Firm'],['Ø§Ù„Ù’ÙˆÙÙ„ÙÙŠÙ‘','Al-Waliyy','The Protecting Friend'],['Ø§Ù„Ù’Ø­ÙÙ…ÙÙŠØ¯','Al-Hamid','The Praiseworthy'],['Ø§Ù„Ù’Ù…ÙØ­Ù’ØµÙÙŠ','Al-Muhsi','The Reckoner'],['Ø§Ù„Ù’Ù…ÙØ¨Ù’Ø¯ÙØ¦','Al-Mubdi','The Originator'],['Ø§Ù„Ù’Ù…ÙØ¹ÙÙŠØ¯','Al-Muid','The Restorer'],['Ø§Ù„Ù’Ù…ÙØ­Ù’ÙŠÙÙŠ','Al-Muhyi','The Giver of Life'],['Ø§Ù„Ù’Ù…ÙÙ…ÙÙŠØª','Al-Mumit','The Taker of Life'],['Ø§Ù„Ù’Ø­ÙÙŠÙ‘','Al-Hayy','The Ever-Living'],['Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…','Al-Qayyum','The Self-Subsisting'],['Ø§Ù„Ù’ÙˆÙØ§Ø¬ÙØ¯','Al-Wajid','The Finder'],['Ø§Ù„Ù’Ù…ÙØ§Ø¬ÙØ¯','Al-Majid','The Noble'],['Ø§Ù„Ù’ÙˆÙØ§Ø­ÙØ¯','Al-Wahid','The Unique'],['Ø§Ù„ØµÙÙ‘Ù…ÙØ¯','As-Samad','The Eternal Refuge'],['Ø§Ù„Ù’Ù‚ÙØ§Ø¯ÙØ±','Al-Qadir','The Capable'],['Ø§Ù„Ù’Ù…ÙÙ‚Ù’ØªÙØ¯ÙØ±','Al-Muqtadir','The Omnipotent'],['Ø§Ù„Ù’Ù…ÙÙ‚ÙØ¯ÙÙ‘Ù…','Al-Muqaddim','The Expeditor'],['Ø§Ù„Ù’Ù…ÙØ¤ÙØ®ÙÙ‘Ø±','Al-Muakhkhir','The Delayer'],['Ø§Ù„Ø£ÙÙˆÙÙ‘Ù„','Al-Awwal','The First'],['Ø§Ù„Ø¢Ø®ÙØ±','Al-Akhir','The Last'],['Ø§Ù„Ø¸ÙÙ‘Ø§Ù‡ÙØ±','Az-Zahir','The Manifest'],['Ø§Ù„Ù’Ø¨ÙØ§Ø·ÙÙ†','Al-Batin','The Hidden'],['Ø§Ù„Ù’ÙˆÙØ§Ù„ÙÙŠ','Al-Wali','The Governor'],['Ø§Ù„Ù’Ù…ÙØªÙØ¹ÙØ§Ù„ÙÙŠ','Al-Mutaali','The Self Exalted'],['Ø§Ù„Ù’Ø¨ÙØ±Ù‘','Al-Barr','The Source of Goodness'],['Ø§Ù„ØªÙÙ‘ÙˆÙÙ‘Ø§Ø¨','At-Tawwab','The Acceptor of Repentance'],['Ø§Ù„Ù’Ù…ÙÙ†Ù’ØªÙÙ‚ÙÙ…','Al-Muntaqim','The Avenger'],['Ø§Ù„Ù’Ø¹ÙÙÙÙˆÙ‘','Al-Afuww','The Pardoner'],['Ø§Ù„Ø±ÙÙ‘Ø¤ÙÙˆÙ','Ar-Rauf','The Kind'],['Ù…ÙØ§Ù„ÙÙƒÙ Ø§Ù„Ù’Ù…ÙÙ„Ù’Ùƒ','Malik-ul-Mulk','Owner of Sovereignty'],['Ø°ÙÙˆ Ø§Ù„Ù’Ø¬ÙÙ„Ø§ÙÙ„Ù ÙˆÙØ§Ù„Ø¥ÙÙƒÙ’Ø±ÙØ§Ù…','Dhul-Jalali-Wal-Ikram','Lord of Majesty'],['Ø§Ù„Ù’Ù…ÙÙ‚Ù’Ø³ÙØ·','Al-Muqsit','The Equitable'],['Ø§Ù„Ù’Ø¬ÙØ§Ù…ÙØ¹','Al-Jami','The Gatherer'],['Ø§Ù„Ù’ØºÙÙ†ÙÙŠÙ‘','Al-Ghani','The Self-Sufficient'],['Ø§Ù„Ù’Ù…ÙØºÙ’Ù†ÙÙŠ','Al-Mughni','The Enricher'],['Ø§Ù„Ù’Ù…ÙØ§Ù†ÙØ¹','Al-Mani','The Preventer'],['Ø§Ù„Ø¶ÙÙ‘Ø§Ø±Ù‘','Ad-Darr','The Distresser'],['Ø§Ù„Ù†ÙÙ‘Ø§ÙÙØ¹','An-Nafi','The Propitious'],['Ø§Ù„Ù†ÙÙ‘ÙˆØ±','An-Nur','The Light'],['Ø§Ù„Ù’Ù‡ÙØ§Ø¯ÙÙŠ','Al-Hadi','The Guide'],['Ø§Ù„Ù’Ø¨ÙØ¯ÙÙŠØ¹','Al-Badi','The Originator'],['Ø§Ù„Ù’Ø¨ÙØ§Ù‚ÙÙŠ','Al-Baqi','The Everlasting'],['Ø§Ù„Ù’ÙˆÙØ§Ø±ÙØ«','Al-Warith','The Inheritor'],['Ø§Ù„Ø±ÙÙ‘Ø´ÙÙŠØ¯','Ar-Rashid','The Guide to Right Path'],['Ø§Ù„ØµÙÙ‘Ø¨ÙÙˆØ±','As-Sabur','The Patient One']
];
let namesBuilt=false;
function buildNames(){
  if(namesBuilt)return;namesBuilt=true;
  const grid=document.getElementById('names-grid');
  NAMES99.forEach(([ar,latin,en],i)=>{
    const div=document.createElement('div');div.className='name-card';
    div.innerHTML=`<div class="name-num">${String(i+1).padStart(2,'0')}</div><div class="name-ar">${ar}</div><div class="name-en">${en}</div>`;
    div.onclick=()=>openName(ar,latin,en);
    grid.appendChild(div);
  });
}
async function openName(ar,latin,en){
  document.getElementById('nm-ar').textContent=ar;
  document.getElementById('nm-latin').textContent=latin;
  document.getElementById('nm-meaning').textContent=en;
  document.getElementById('nm-ai').className='name-modal-ai';
  document.getElementById('nm-ai').textContent='';
  document.getElementById('name-modal').classList.add('show');
  try{
    const sys=`You are Imam Al-Faruq. Explain the deep spiritual meaning of the divine Name "${latin}" (${ar}) â€” how it appears in Quran, what it means for a believer's life, and how to reflect on it during Ramadan. Be poetic but concise â€” 3-4 sentences.`;
    const reply=await callAI(sys,[{role:'user',content:`Explain the name ${latin}`}],300);
    document.getElementById('nm-ai').textContent=reply;
    document.getElementById('nm-ai').classList.add('show');
    addXP(10);
  }catch(e){}
}
function closeNameModal(){document.getElementById('name-modal').classList.remove('show');}

// ==================== ISNAD ====================
async function genIsnad(){
  const hadith=document.getElementById('isnad-in').value.trim();if(!hadith)return;
  document.querySelector('.btn-isnad').textContent='ğŸ”— Building chain...';
  const sys=`You are Imam Al-Faruq. For the given hadith, create an isnad (chain of narrators) from Prophet Muhammad ï·º down to the compiler. 
Respond ONLY with valid JSON (no markdown):
{"title":"<short hadith title>","chain":[{"arabic":"<name in Arabic>","english":"<name in English>","era":"<e.g. Prophet of Allah, d. 632 CE>"},...]}`  ;
  try{
    const raw=await callAI(sys,[{role:'user',content:hadith}],500);
    const clean=raw.replace(/```json|```/g,'').trim();
    const p=JSON.parse(clean);
    const flow=document.getElementById('chain-flow');flow.innerHTML='';
    document.querySelector('.chain-title').textContent=`âœ¦ ${p.title} âœ¦`;
    p.chain.forEach((node,i)=>{
      const div=document.createElement('div');div.className='chain-node';
      div.innerHTML=`<div class="chain-node-ar">${node.arabic}</div><div class="chain-node-en">${node.english}</div><div class="chain-node-era">${node.era}</div>`;
      flow.appendChild(div);
      if(i<p.chain.length-1){const arr=document.createElement('div');arr.className='chain-arrow';arr.textContent='â†“';flow.appendChild(arr);}
    });
    document.getElementById('isnad-viz').classList.add('show');addXP(45);showToast('+45 XP â€” Isnad chain visualized ğŸ”—');
  }catch(e){alert('Could not generate chain. Try again.');}
  document.querySelector('.btn-isnad').textContent='ğŸ”—  Visualize Isnad Chain';
}

// ==================== XP ====================
function addXP(amt){
  XP+=amt;
  let lvl=LEVELS[0];for(const l of LEVELS)if(XP>=l.m)lvl=l;
  const idx=LEVELS.indexOf(lvl);const next=LEVELS[idx+1];
  const pct=next?Math.min(100,((XP-lvl.m)/(next.m-lvl.m))*100):100;
  document.getElementById('xp-fill').style.width=pct+'%';
  document.getElementById('lvl-badge').textContent=lvl.n;
}
function showToast(msg){
  const t=document.createElement('div');t.className='toast';t.textContent=msg;
  document.body.appendChild(t);setTimeout(()=>t.remove(),3200);
}
function doCopy(txt,id){
  navigator.clipboard.writeText(txt).then(()=>{
    const b=document.getElementById(id);b.textContent='âœ“';b.classList.add('ok');
    setTimeout(()=>{b.textContent='Copy';b.classList.remove('ok');},2000);
  });
}
</script>
</body>
</html>
